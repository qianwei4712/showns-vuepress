<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <meta name="generator" content="VuePress 2.0.0-beta.67">
    <style>
      :root {
        --c-bg: #fff;
      }
      html.dark {
        --c-bg: #22272e;
      }
      html, body {
        background-color: var(--c-bg);
      }
    </style>
    <script>
      const userMode = localStorage.getItem('vuepress-color-scheme');
			const systemDarkMode = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches;
			if (userMode === 'dark' || (userMode !== 'light' && systemDarkMode)) {
				document.documentElement.classList.toggle('dark', true);
			}
    </script>
    <title>路的尽头在哪</title><meta name="description" content="做人最重要的是开心">
    <link rel="preload" href="/showns-vuepress/assets/style-b01123cb.css" as="style"><link rel="stylesheet" href="/showns-vuepress/assets/style-b01123cb.css">
    <link rel="modulepreload" href="/showns-vuepress/assets/app-85a03126.js"><link rel="modulepreload" href="/showns-vuepress/assets/Activiti7Workflow.html-0b2ef192.js"><link rel="modulepreload" href="/showns-vuepress/assets/Activiti7Workflow.html-92e36560.js"><link rel="prefetch" href="/showns-vuepress/assets/index.html-b061c35b.js" as="script"><link rel="prefetch" href="/showns-vuepress/assets/index.html-7f3225ef.js" as="script"><link rel="prefetch" href="/showns-vuepress/assets/JwtPrinciple.html-a1ae5336.js" as="script"><link rel="prefetch" href="/showns-vuepress/assets/MybatisPlusDbs.html-76d431f1.js" as="script"><link rel="prefetch" href="/showns-vuepress/assets/MysqlPrinciple.html-78dd0af1.js" as="script"><link rel="prefetch" href="/showns-vuepress/assets/QuartzBaseApply.html-f63c8e95.js" as="script"><link rel="prefetch" href="/showns-vuepress/assets/DockerGiteaMysql.html-567a71fc.js" as="script"><link rel="prefetch" href="/showns-vuepress/assets/DubboZookeeperFirst.html-e6a95f14.js" as="script"><link rel="prefetch" href="/showns-vuepress/assets/ExplainKeyColumn.html-ef8d3a14.js" as="script"><link rel="prefetch" href="/showns-vuepress/assets/SomethingNotes.html-aef85742.js" as="script"><link rel="prefetch" href="/showns-vuepress/assets/JenkinsGiteeNpmBuild.html-6fcb377d.js" as="script"><link rel="prefetch" href="/showns-vuepress/assets/JenkinsMavenDockerfile.html-fcf05556.js" as="script"><link rel="prefetch" href="/showns-vuepress/assets/MysqldumpBackupSql.html-6acaa643.js" as="script"><link rel="prefetch" href="/showns-vuepress/assets/MqCompare.html-57f9705f.js" as="script"><link rel="prefetch" href="/showns-vuepress/assets/NginxLoadBalancing.html-9167c604.js" as="script"><link rel="prefetch" href="/showns-vuepress/assets/RabbitMqBase.html-c3930d18.js" as="script"><link rel="prefetch" href="/showns-vuepress/assets/RabbitMqHighClass.html-5c8829a0.js" as="script"><link rel="prefetch" href="/showns-vuepress/assets/RedisStudy.html-2bfe2278.js" as="script"><link rel="prefetch" href="/showns-vuepress/assets/TomcatOptimize.html-7923bcff.js" as="script"><link rel="prefetch" href="/showns-vuepress/assets/BehavioralMode.html-c0f31b37.js" as="script"><link rel="prefetch" href="/showns-vuepress/assets/CreationMode.html-3b74e997.js" as="script"><link rel="prefetch" href="/showns-vuepress/assets/RegularExpression.html-e8acfd36.js" as="script"><link rel="prefetch" href="/showns-vuepress/assets/SortingAlgorithm.html-4e9f408b.js" as="script"><link rel="prefetch" href="/showns-vuepress/assets/StructuralMode.html-300ccbbf.js" as="script"><link rel="prefetch" href="/showns-vuepress/assets/WebAttackSafe.html-9a6cbcf0.js" as="script"><link rel="prefetch" href="/showns-vuepress/assets/WebSafeTest.html-61e26be3.js" as="script"><link rel="prefetch" href="/showns-vuepress/assets/CompareGetPsot.html-ca71b48e.js" as="script"><link rel="prefetch" href="/showns-vuepress/assets/EbookOnline.html-db161086.js" as="script"><link rel="prefetch" href="/showns-vuepress/assets/SomethingNotes.html-66896cec.js" as="script"><link rel="prefetch" href="/showns-vuepress/assets/CommonSoftwareDeploy.html-7b7b22f1.js" as="script"><link rel="prefetch" href="/showns-vuepress/assets/DockerCompose.html-9d52d4dc.js" as="script"><link rel="prefetch" href="/showns-vuepress/assets/DockerInstall.html-8d772fc4.js" as="script"><link rel="prefetch" href="/showns-vuepress/assets/LinuxCommonCommand.html-4554d951.js" as="script"><link rel="prefetch" href="/showns-vuepress/assets/NginxBindPortWithDomain.html-54000ccb.js" as="script"><link rel="prefetch" href="/showns-vuepress/assets/HeapAndStack.html-4ff05c3b.js" as="script"><link rel="prefetch" href="/showns-vuepress/assets/TreeAndCommons.html-8254819d.js" as="script"><link rel="prefetch" href="/showns-vuepress/assets/WhatisHash.html-201f8317.js" as="script"><link rel="prefetch" href="/showns-vuepress/assets/WhatisHeap.html-37aaa3cb.js" as="script"><link rel="prefetch" href="/showns-vuepress/assets/AboutUtilSet.html-224a7006.js" as="script"><link rel="prefetch" href="/showns-vuepress/assets/ArrayListSource.html-e0d160af.js" as="script"><link rel="prefetch" href="/showns-vuepress/assets/CollectionComparison.html-73775204.js" as="script"><link rel="prefetch" href="/showns-vuepress/assets/CollectionRelationDiagram.html-c2040b83.js" as="script"><link rel="prefetch" href="/showns-vuepress/assets/HashMapSource.html-ea445785.js" as="script"><link rel="prefetch" href="/showns-vuepress/assets/LinkedHashMap.html-662afa85.js" as="script"><link rel="prefetch" href="/showns-vuepress/assets/LinkedListSource.html-ff767117.js" as="script"><link rel="prefetch" href="/showns-vuepress/assets/PriorityQueueSource.html-1950ac80.js" as="script"><link rel="prefetch" href="/showns-vuepress/assets/StackAndQueue.html-af1e4a3a.js" as="script"><link rel="prefetch" href="/showns-vuepress/assets/TreeMapSource.html-3b8ab96c.js" as="script"><link rel="prefetch" href="/showns-vuepress/assets/VectorSource.html-1032cca5.js" as="script"><link rel="prefetch" href="/showns-vuepress/assets/WeakHashMap.html-50f099fd.js" as="script"><link rel="prefetch" href="/showns-vuepress/assets/CookieAndSession.html-0860e3ab.js" as="script"><link rel="prefetch" href="/showns-vuepress/assets/JudgeThreadPoolDone.html-50772c22.js" as="script"><link rel="prefetch" href="/showns-vuepress/assets/OldBoysThoughts.html-ac296560.js" as="script"><link rel="prefetch" href="/showns-vuepress/assets/SomethingNotes.html-d56b4044.js" as="script"><link rel="prefetch" href="/showns-vuepress/assets/IoBaseKonwledge.html-5e5e4d40.js" as="script"><link rel="prefetch" href="/showns-vuepress/assets/JavaAioAbout.html-2729e183.js" as="script"><link rel="prefetch" href="/showns-vuepress/assets/JavaBioAbout.html-cf9f3012.js" as="script"><link rel="prefetch" href="/showns-vuepress/assets/JavaNioAbout.html-7248f14f.js" as="script"><link rel="prefetch" href="/showns-vuepress/assets/NettyStudy.html-2c8192a8.js" as="script"><link rel="prefetch" href="/showns-vuepress/assets/ByteCodeFile.html-f4a6e173.js" as="script"><link rel="prefetch" href="/showns-vuepress/assets/ClassLoader.html-bbd01559.js" as="script"><link rel="prefetch" href="/showns-vuepress/assets/ExecutionEngine.html-4bb54282.js" as="script"><link rel="prefetch" href="/showns-vuepress/assets/GarbageCollection.html-0a12d3f8.js" as="script"><link rel="prefetch" href="/showns-vuepress/assets/GcAlgorithmn.html-40e10ce4.js" as="script"><link rel="prefetch" href="/showns-vuepress/assets/JvmTotalSee.html-b2b59672.js" as="script"><link rel="prefetch" href="/showns-vuepress/assets/MonitorTools.html-64f0a0c9.js" as="script"><link rel="prefetch" href="/showns-vuepress/assets/RuntimeStruc.html-c533def9.js" as="script"><link rel="prefetch" href="/showns-vuepress/assets/CommonMethodAndEnum.html-42d820b1.js" as="script"><link rel="prefetch" href="/showns-vuepress/assets/EncapInheritPolymo.html-abbb7609.js" as="script"><link rel="prefetch" href="/showns-vuepress/assets/ExceptionAndSerializable.html-61a95204.js" as="script"><link rel="prefetch" href="/showns-vuepress/assets/InterAbstInner.html-de352232.js" as="script"><link rel="prefetch" href="/showns-vuepress/assets/Java8NewChara.html-9171f152.js" as="script"><link rel="prefetch" href="/showns-vuepress/assets/JavaAnnotation.html-86dffbff.js" as="script"><link rel="prefetch" href="/showns-vuepress/assets/RunTimeReflect.html-ecf8e41e.js" as="script"><link rel="prefetch" href="/showns-vuepress/assets/AbstractQueuedSynchronizer.html-548dbc0d.js" as="script"><link rel="prefetch" href="/showns-vuepress/assets/AtomicCasUnSafe.html-f2965333.js" as="script"><link rel="prefetch" href="/showns-vuepress/assets/CountDownLatch.html-e5cc29b4.js" as="script"><link rel="prefetch" href="/showns-vuepress/assets/CyclicBarrier.html-e231938d.js" as="script"><link rel="prefetch" href="/showns-vuepress/assets/LockSupport.html-1239e17c.js" as="script"><link rel="prefetch" href="/showns-vuepress/assets/Synchronized.html-4bde0992.js" as="script"><link rel="prefetch" href="/showns-vuepress/assets/ThreadBaseConcept.html-623736e4.js" as="script"><link rel="prefetch" href="/showns-vuepress/assets/ThreadTheoryBase.html-7f3b4b7b.js" as="script"><link rel="prefetch" href="/showns-vuepress/assets/Volatile.html-94066749.js" as="script"><link rel="prefetch" href="/showns-vuepress/assets/ArchitectureIntro.html-28044f52.js" as="script"><link rel="prefetch" href="/showns-vuepress/assets/BeanConfigoure.html-381e3c0c.js" as="script"><link rel="prefetch" href="/showns-vuepress/assets/IoCAndDI.html-33af87fd.js" as="script"><link rel="prefetch" href="/showns-vuepress/assets/SpringAspect.html-42c4cdc4.js" as="script"><link rel="prefetch" href="/showns-vuepress/assets/ActiveMqIntegre.html-6aeb93af.js" as="script"><link rel="prefetch" href="/showns-vuepress/assets/LogbackIntegre.html-b1edcd15.js" as="script"><link rel="prefetch" href="/showns-vuepress/assets/EurekaDemo.html-cfdfd1e2.js" as="script"><link rel="prefetch" href="/showns-vuepress/assets/GatewayDemo.html-3666e6b2.js" as="script"><link rel="prefetch" href="/showns-vuepress/assets/HystrixDemo.html-613de6b0.js" as="script"><link rel="prefetch" href="/showns-vuepress/assets/OpenFegin.html-720fdf32.js" as="script"><link rel="prefetch" href="/showns-vuepress/assets/RibbonDemo.html-781f4763.js" as="script"><link rel="prefetch" href="/showns-vuepress/assets/SomethingNotes.html-66d048eb.js" as="script"><link rel="prefetch" href="/showns-vuepress/assets/VersionSelect.html-1fe51954.js" as="script"><link rel="prefetch" href="/showns-vuepress/assets/404.html-f9875e7b.js" as="script"><link rel="prefetch" href="/showns-vuepress/assets/index.html-67730b48.js" as="script"><link rel="prefetch" href="/showns-vuepress/assets/index.html-52b25ab3.js" as="script"><link rel="prefetch" href="/showns-vuepress/assets/JwtPrinciple.html-62dcaa63.js" as="script"><link rel="prefetch" href="/showns-vuepress/assets/MybatisPlusDbs.html-b1dd9475.js" as="script"><link rel="prefetch" href="/showns-vuepress/assets/MysqlPrinciple.html-5658ebd5.js" as="script"><link rel="prefetch" href="/showns-vuepress/assets/QuartzBaseApply.html-3e354332.js" as="script"><link rel="prefetch" href="/showns-vuepress/assets/DockerGiteaMysql.html-50fef1cb.js" as="script"><link rel="prefetch" href="/showns-vuepress/assets/DubboZookeeperFirst.html-9c5bd47e.js" as="script"><link rel="prefetch" href="/showns-vuepress/assets/ExplainKeyColumn.html-693ba11d.js" as="script"><link rel="prefetch" href="/showns-vuepress/assets/SomethingNotes.html-e8b6a105.js" as="script"><link rel="prefetch" href="/showns-vuepress/assets/JenkinsGiteeNpmBuild.html-81b0f3f3.js" as="script"><link rel="prefetch" href="/showns-vuepress/assets/JenkinsMavenDockerfile.html-711f0e05.js" as="script"><link rel="prefetch" href="/showns-vuepress/assets/MysqldumpBackupSql.html-ec9b2409.js" as="script"><link rel="prefetch" href="/showns-vuepress/assets/MqCompare.html-1ca77404.js" as="script"><link rel="prefetch" href="/showns-vuepress/assets/NginxLoadBalancing.html-097b52ae.js" as="script"><link rel="prefetch" href="/showns-vuepress/assets/RabbitMqBase.html-45e1487d.js" as="script"><link rel="prefetch" href="/showns-vuepress/assets/RabbitMqHighClass.html-7f052475.js" as="script"><link rel="prefetch" href="/showns-vuepress/assets/RedisStudy.html-496e7a10.js" as="script"><link rel="prefetch" href="/showns-vuepress/assets/TomcatOptimize.html-d9c7aa2d.js" as="script"><link rel="prefetch" href="/showns-vuepress/assets/BehavioralMode.html-85dd86f2.js" as="script"><link rel="prefetch" href="/showns-vuepress/assets/CreationMode.html-71bd975f.js" as="script"><link rel="prefetch" href="/showns-vuepress/assets/RegularExpression.html-23848ff3.js" as="script"><link rel="prefetch" href="/showns-vuepress/assets/SortingAlgorithm.html-b82741e4.js" as="script"><link rel="prefetch" href="/showns-vuepress/assets/StructuralMode.html-43fb5bd9.js" as="script"><link rel="prefetch" href="/showns-vuepress/assets/WebAttackSafe.html-3fb6a493.js" as="script"><link rel="prefetch" href="/showns-vuepress/assets/WebSafeTest.html-3d65716f.js" as="script"><link rel="prefetch" href="/showns-vuepress/assets/CompareGetPsot.html-d4a73371.js" as="script"><link rel="prefetch" href="/showns-vuepress/assets/EbookOnline.html-e3a3f407.js" as="script"><link rel="prefetch" href="/showns-vuepress/assets/SomethingNotes.html-171314b2.js" as="script"><link rel="prefetch" href="/showns-vuepress/assets/CommonSoftwareDeploy.html-cd4a8b44.js" as="script"><link rel="prefetch" href="/showns-vuepress/assets/DockerCompose.html-a3e49177.js" as="script"><link rel="prefetch" href="/showns-vuepress/assets/DockerInstall.html-7b39fe0e.js" as="script"><link rel="prefetch" href="/showns-vuepress/assets/LinuxCommonCommand.html-55d2c157.js" as="script"><link rel="prefetch" href="/showns-vuepress/assets/NginxBindPortWithDomain.html-980a6b9a.js" as="script"><link rel="prefetch" href="/showns-vuepress/assets/HeapAndStack.html-3ca74523.js" as="script"><link rel="prefetch" href="/showns-vuepress/assets/TreeAndCommons.html-f16cc3c1.js" as="script"><link rel="prefetch" href="/showns-vuepress/assets/WhatisHash.html-b81c226f.js" as="script"><link rel="prefetch" href="/showns-vuepress/assets/WhatisHeap.html-47b35608.js" as="script"><link rel="prefetch" href="/showns-vuepress/assets/AboutUtilSet.html-6e2baa28.js" as="script"><link rel="prefetch" href="/showns-vuepress/assets/ArrayListSource.html-62254e60.js" as="script"><link rel="prefetch" href="/showns-vuepress/assets/CollectionComparison.html-f07622a3.js" as="script"><link rel="prefetch" href="/showns-vuepress/assets/CollectionRelationDiagram.html-3bdb9e76.js" as="script"><link rel="prefetch" href="/showns-vuepress/assets/HashMapSource.html-58166b9c.js" as="script"><link rel="prefetch" href="/showns-vuepress/assets/LinkedHashMap.html-03258699.js" as="script"><link rel="prefetch" href="/showns-vuepress/assets/LinkedListSource.html-ff5bfc7d.js" as="script"><link rel="prefetch" href="/showns-vuepress/assets/PriorityQueueSource.html-e287da5e.js" as="script"><link rel="prefetch" href="/showns-vuepress/assets/StackAndQueue.html-f6ed1384.js" as="script"><link rel="prefetch" href="/showns-vuepress/assets/TreeMapSource.html-78bceb58.js" as="script"><link rel="prefetch" href="/showns-vuepress/assets/VectorSource.html-69df4c64.js" as="script"><link rel="prefetch" href="/showns-vuepress/assets/WeakHashMap.html-e0a0decf.js" as="script"><link rel="prefetch" href="/showns-vuepress/assets/CookieAndSession.html-4ebd53e6.js" as="script"><link rel="prefetch" href="/showns-vuepress/assets/JudgeThreadPoolDone.html-03ff8961.js" as="script"><link rel="prefetch" href="/showns-vuepress/assets/OldBoysThoughts.html-b08011dd.js" as="script"><link rel="prefetch" href="/showns-vuepress/assets/SomethingNotes.html-7f61d46d.js" as="script"><link rel="prefetch" href="/showns-vuepress/assets/IoBaseKonwledge.html-5d6bbe90.js" as="script"><link rel="prefetch" href="/showns-vuepress/assets/JavaAioAbout.html-10dbb721.js" as="script"><link rel="prefetch" href="/showns-vuepress/assets/JavaBioAbout.html-2c51bf8b.js" as="script"><link rel="prefetch" href="/showns-vuepress/assets/JavaNioAbout.html-b963bf3b.js" as="script"><link rel="prefetch" href="/showns-vuepress/assets/NettyStudy.html-964008a0.js" as="script"><link rel="prefetch" href="/showns-vuepress/assets/ByteCodeFile.html-eeae4c4e.js" as="script"><link rel="prefetch" href="/showns-vuepress/assets/ClassLoader.html-aeedfeb9.js" as="script"><link rel="prefetch" href="/showns-vuepress/assets/ExecutionEngine.html-81681ec1.js" as="script"><link rel="prefetch" href="/showns-vuepress/assets/GarbageCollection.html-68517770.js" as="script"><link rel="prefetch" href="/showns-vuepress/assets/GcAlgorithmn.html-fbe06611.js" as="script"><link rel="prefetch" href="/showns-vuepress/assets/JvmTotalSee.html-4a7a8ad0.js" as="script"><link rel="prefetch" href="/showns-vuepress/assets/MonitorTools.html-e0190a52.js" as="script"><link rel="prefetch" href="/showns-vuepress/assets/RuntimeStruc.html-ebe5aab3.js" as="script"><link rel="prefetch" href="/showns-vuepress/assets/CommonMethodAndEnum.html-87759f03.js" as="script"><link rel="prefetch" href="/showns-vuepress/assets/EncapInheritPolymo.html-19cb79dd.js" as="script"><link rel="prefetch" href="/showns-vuepress/assets/ExceptionAndSerializable.html-6af28e50.js" as="script"><link rel="prefetch" href="/showns-vuepress/assets/InterAbstInner.html-98751427.js" as="script"><link rel="prefetch" href="/showns-vuepress/assets/Java8NewChara.html-79b24cf3.js" as="script"><link rel="prefetch" href="/showns-vuepress/assets/JavaAnnotation.html-15e39cdb.js" as="script"><link rel="prefetch" href="/showns-vuepress/assets/RunTimeReflect.html-5a9e2879.js" as="script"><link rel="prefetch" href="/showns-vuepress/assets/AbstractQueuedSynchronizer.html-26c4d8b3.js" as="script"><link rel="prefetch" href="/showns-vuepress/assets/AtomicCasUnSafe.html-a1f06bf7.js" as="script"><link rel="prefetch" href="/showns-vuepress/assets/CountDownLatch.html-a4708d69.js" as="script"><link rel="prefetch" href="/showns-vuepress/assets/CyclicBarrier.html-263c384e.js" as="script"><link rel="prefetch" href="/showns-vuepress/assets/LockSupport.html-74811076.js" as="script"><link rel="prefetch" href="/showns-vuepress/assets/Synchronized.html-947d8636.js" as="script"><link rel="prefetch" href="/showns-vuepress/assets/ThreadBaseConcept.html-c8bc1525.js" as="script"><link rel="prefetch" href="/showns-vuepress/assets/ThreadTheoryBase.html-965437e0.js" as="script"><link rel="prefetch" href="/showns-vuepress/assets/Volatile.html-a0d63dde.js" as="script"><link rel="prefetch" href="/showns-vuepress/assets/ArchitectureIntro.html-037a32ee.js" as="script"><link rel="prefetch" href="/showns-vuepress/assets/BeanConfigoure.html-81c4108e.js" as="script"><link rel="prefetch" href="/showns-vuepress/assets/IoCAndDI.html-a34f2fa6.js" as="script"><link rel="prefetch" href="/showns-vuepress/assets/SpringAspect.html-ea190afa.js" as="script"><link rel="prefetch" href="/showns-vuepress/assets/ActiveMqIntegre.html-f9f3e7e4.js" as="script"><link rel="prefetch" href="/showns-vuepress/assets/LogbackIntegre.html-020dde6c.js" as="script"><link rel="prefetch" href="/showns-vuepress/assets/EurekaDemo.html-3ab3e771.js" as="script"><link rel="prefetch" href="/showns-vuepress/assets/GatewayDemo.html-d615ab4c.js" as="script"><link rel="prefetch" href="/showns-vuepress/assets/HystrixDemo.html-81f7efe1.js" as="script"><link rel="prefetch" href="/showns-vuepress/assets/OpenFegin.html-31095695.js" as="script"><link rel="prefetch" href="/showns-vuepress/assets/RibbonDemo.html-95250f9d.js" as="script"><link rel="prefetch" href="/showns-vuepress/assets/SomethingNotes.html-e97edcce.js" as="script"><link rel="prefetch" href="/showns-vuepress/assets/VersionSelect.html-8c668ccc.js" as="script"><link rel="prefetch" href="/showns-vuepress/assets/404.html-6d6cfed8.js" as="script">
  </head>
  <body>
    <div id="app"><!--[--><div class="theme-container"><!--[--><header class="navbar"><div class="toggle-sidebar-button" title="toggle sidebar" aria-expanded="false" role="button" tabindex="0"><div class="icon" aria-hidden="true"><span></span><span></span><span></span></div></div><span><a href="/showns-vuepress/" class=""><!----><span class="site-name">路的尽头在哪</span></a></span><div class="navbar-items-wrapper" style=""><!--[--><!--]--><nav class="navbar-items can-hide"><!--[--><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="Java"><span class="title">Java</span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="Java"><span class="title">Java</span><span class="right arrow"></span></button><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><a href="/showns-vuepress/java/oopbase/Java8NewChara.html" class="" aria-label="Java面向对象基础"><!--[--><!--]--> Java面向对象基础 <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/showns-vuepress/java/collections/CollectionRelationDiagram.html" class="" aria-label="Java集合知识体系"><!--[--><!--]--> Java集合知识体系 <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/showns-vuepress/java/iokonwledge/IoBaseKonwledge.html" class="" aria-label="Java IO知识体系"><!--[--><!--]--> Java IO知识体系 <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/showns-vuepress/java/thread/ThreadTheoryBase.html" class="" aria-label="Java 多线程与并发"><!--[--><!--]--> Java 多线程与并发 <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/showns-vuepress/java/jvm/JvmTotalSee.html" class="" aria-label="Java 虚拟机"><!--[--><!--]--> Java 虚拟机 <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/showns-vuepress/java/fqa/OldBoysThoughts.html" class="" aria-label="散记"><!--[--><!--]--> 散记 <!--[--><!--]--></a></li><!--]--></ul></div></div><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="Spring"><span class="title">Spring</span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="Spring"><span class="title">Spring</span><span class="right arrow"></span></button><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><a href="/showns-vuepress/spring/base/IoCAndDI.html" class="" aria-label="Spring 基础"><!--[--><!--]--> Spring 基础 <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/showns-vuepress/spring/boot/LogbackIntegre.html" class="" aria-label="Spring Boot"><!--[--><!--]--> Spring Boot <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/showns-vuepress/spring/cloud/eurekaDemo.html" class="" aria-label="Spring cloud"><!--[--><!--]--> Spring cloud <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/showns-vuepress/spring/fqa/VersionSelect.html" class="" aria-label="Spring FQA"><!--[--><!--]--> Spring FQA <!--[--><!--]--></a></li><!--]--></ul></div></div><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="应用"><span class="title">应用</span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="应用"><span class="title">应用</span><span class="right arrow"></span></button><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><a href="/showns-vuepress/apply/frame/MysqlPrinciple.html" class="" aria-label="框架"><!--[--><!--]--> 框架 <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/showns-vuepress/apply/middleware/NginxLoadBalancing.html" class="" aria-label="中间件"><!--[--><!--]--> 中间件 <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/showns-vuepress/apply/tool/MysqldumpBackupSql.html" class="" aria-label="工具"><!--[--><!--]--> 工具 <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/showns-vuepress/apply/fqa/SomethingNotes.html" class="" aria-label="散记"><!--[--><!--]--> 散记 <!--[--><!--]--></a></li><!--]--></ul></div></div><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="攻城狮"><span class="title">攻城狮</span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="攻城狮"><span class="title">攻城狮</span><span class="right arrow"></span></button><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><a href="/showns-vuepress/deploy/server/CommonSoftwareDeploy.html" class="" aria-label="服务器"><!--[--><!--]--> 服务器 <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/showns-vuepress/deploy/designpattern/RegularExpression.html" class="" aria-label="设计与方法论"><!--[--><!--]--> 设计与方法论 <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/showns-vuepress/deploy/structure/WhatisHash.html" class="" aria-label="算法与数据结构"><!--[--><!--]--> 算法与数据结构 <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/showns-vuepress/deploy/fqa/SomethingNotes.html" class="" aria-label="散记"><!--[--><!--]--> 散记 <!--[--><!--]--></a></li><!--]--></ul></div></div><div class="navbar-item"><a href="/showns-vuepress/" class="" aria-label="百宝箱"><!--[--><!--]--> 百宝箱 <!--[--><!--]--></a></div><!--]--></nav><!--[--><!--]--><button class="toggle-color-mode-button" title="toggle color mode"><svg style="" class="icon" focusable="false" viewBox="0 0 32 32"><path d="M16 12.005a4 4 0 1 1-4 4a4.005 4.005 0 0 1 4-4m0-2a6 6 0 1 0 6 6a6 6 0 0 0-6-6z" fill="currentColor"></path><path d="M5.394 6.813l1.414-1.415l3.506 3.506L8.9 10.318z" fill="currentColor"></path><path d="M2 15.005h5v2H2z" fill="currentColor"></path><path d="M5.394 25.197L8.9 21.691l1.414 1.415l-3.506 3.505z" fill="currentColor"></path><path d="M15 25.005h2v5h-2z" fill="currentColor"></path><path d="M21.687 23.106l1.414-1.415l3.506 3.506l-1.414 1.414z" fill="currentColor"></path><path d="M25 15.005h5v2h-5z" fill="currentColor"></path><path d="M21.687 8.904l3.506-3.506l1.414 1.415l-3.506 3.505z" fill="currentColor"></path><path d="M15 2.005h2v5h-2z" fill="currentColor"></path></svg><svg style="display:none;" class="icon" focusable="false" viewBox="0 0 32 32"><path d="M13.502 5.414a15.075 15.075 0 0 0 11.594 18.194a11.113 11.113 0 0 1-7.975 3.39c-.138 0-.278.005-.418 0a11.094 11.094 0 0 1-3.2-21.584M14.98 3a1.002 1.002 0 0 0-.175.016a13.096 13.096 0 0 0 1.825 25.981c.164.006.328 0 .49 0a13.072 13.072 0 0 0 10.703-5.555a1.01 1.01 0 0 0-.783-1.565A13.08 13.08 0 0 1 15.89 4.38A1.015 1.015 0 0 0 14.98 3z" fill="currentColor"></path></svg></button><!----></div></header><!--]--><div class="sidebar-mask"></div><!--[--><aside class="sidebar"><nav class="navbar-items"><!--[--><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="Java"><span class="title">Java</span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="Java"><span class="title">Java</span><span class="right arrow"></span></button><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><a href="/showns-vuepress/java/oopbase/Java8NewChara.html" class="" aria-label="Java面向对象基础"><!--[--><!--]--> Java面向对象基础 <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/showns-vuepress/java/collections/CollectionRelationDiagram.html" class="" aria-label="Java集合知识体系"><!--[--><!--]--> Java集合知识体系 <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/showns-vuepress/java/iokonwledge/IoBaseKonwledge.html" class="" aria-label="Java IO知识体系"><!--[--><!--]--> Java IO知识体系 <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/showns-vuepress/java/thread/ThreadTheoryBase.html" class="" aria-label="Java 多线程与并发"><!--[--><!--]--> Java 多线程与并发 <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/showns-vuepress/java/jvm/JvmTotalSee.html" class="" aria-label="Java 虚拟机"><!--[--><!--]--> Java 虚拟机 <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/showns-vuepress/java/fqa/OldBoysThoughts.html" class="" aria-label="散记"><!--[--><!--]--> 散记 <!--[--><!--]--></a></li><!--]--></ul></div></div><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="Spring"><span class="title">Spring</span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="Spring"><span class="title">Spring</span><span class="right arrow"></span></button><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><a href="/showns-vuepress/spring/base/IoCAndDI.html" class="" aria-label="Spring 基础"><!--[--><!--]--> Spring 基础 <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/showns-vuepress/spring/boot/LogbackIntegre.html" class="" aria-label="Spring Boot"><!--[--><!--]--> Spring Boot <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/showns-vuepress/spring/cloud/eurekaDemo.html" class="" aria-label="Spring cloud"><!--[--><!--]--> Spring cloud <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/showns-vuepress/spring/fqa/VersionSelect.html" class="" aria-label="Spring FQA"><!--[--><!--]--> Spring FQA <!--[--><!--]--></a></li><!--]--></ul></div></div><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="应用"><span class="title">应用</span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="应用"><span class="title">应用</span><span class="right arrow"></span></button><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><a href="/showns-vuepress/apply/frame/MysqlPrinciple.html" class="" aria-label="框架"><!--[--><!--]--> 框架 <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/showns-vuepress/apply/middleware/NginxLoadBalancing.html" class="" aria-label="中间件"><!--[--><!--]--> 中间件 <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/showns-vuepress/apply/tool/MysqldumpBackupSql.html" class="" aria-label="工具"><!--[--><!--]--> 工具 <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/showns-vuepress/apply/fqa/SomethingNotes.html" class="" aria-label="散记"><!--[--><!--]--> 散记 <!--[--><!--]--></a></li><!--]--></ul></div></div><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="攻城狮"><span class="title">攻城狮</span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="攻城狮"><span class="title">攻城狮</span><span class="right arrow"></span></button><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><a href="/showns-vuepress/deploy/server/CommonSoftwareDeploy.html" class="" aria-label="服务器"><!--[--><!--]--> 服务器 <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/showns-vuepress/deploy/designpattern/RegularExpression.html" class="" aria-label="设计与方法论"><!--[--><!--]--> 设计与方法论 <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/showns-vuepress/deploy/structure/WhatisHash.html" class="" aria-label="算法与数据结构"><!--[--><!--]--> 算法与数据结构 <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/showns-vuepress/deploy/fqa/SomethingNotes.html" class="" aria-label="散记"><!--[--><!--]--> 散记 <!--[--><!--]--></a></li><!--]--></ul></div></div><div class="navbar-item"><a href="/showns-vuepress/" class="" aria-label="百宝箱"><!--[--><!--]--> 百宝箱 <!--[--><!--]--></a></div><!--]--></nav><!--[--><!--]--><ul class="sidebar-items"><!--[--><li><p tabindex="0" class="sidebar-item sidebar-heading active">框架 <!----></p><ul style="" class="sidebar-item-children"><!--[--><li><a href="/showns-vuepress/apply/frame/MysqlPrinciple.html" class="sidebar-item" aria-label="Database - MySQL 原理深入简介"><!--[--><!--]--> Database - MySQL 原理深入简介 <!--[--><!--]--></a><!----></li><li><a href="/showns-vuepress/apply/frame/JwtPrinciple.html" class="sidebar-item" aria-label="JWT - 无状态身份认证令牌"><!--[--><!--]--> JWT - 无状态身份认证令牌 <!--[--><!--]--></a><!----></li><li><a href="/showns-vuepress/apply/frame/MybatisPlusDbs.html" class="sidebar-item" aria-label="Mybatis-Plus 多数据源"><!--[--><!--]--> Mybatis-Plus 多数据源 <!--[--><!--]--></a><!----></li><li><a href="/showns-vuepress/apply/frame/QuartzBaseApply.html" class="sidebar-item" aria-label="Quartz - 任务调度框架整合使用"><!--[--><!--]--> Quartz - 任务调度框架整合使用 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/showns-vuepress/apply/frame/Activiti7Workflow.html" class="router-link-active router-link-exact-active router-link-active sidebar-item active" aria-label="Activiti - Workflow 最佳实战案例"><!--[--><!--]--> Activiti - Workflow 最佳实战案例 <!--[--><!--]--></a><!----></li><!--]--></ul></li><li><p tabindex="0" class="sidebar-item sidebar-heading">中间件 <!----></p><ul style="" class="sidebar-item-children"><!--[--><li><a href="/showns-vuepress/apply/middleware/NginxLoadBalancing.html" class="sidebar-item" aria-label="Nginx 负载均衡及双机主从模式"><!--[--><!--]--> Nginx 负载均衡及双机主从模式 <!--[--><!--]--></a><!----></li><li><a href="/showns-vuepress/apply/middleware/TomcatOptimize.html" class="sidebar-item" aria-label="Tomcat 8 参数配置性能优化"><!--[--><!--]--> Tomcat 8 参数配置性能优化 <!--[--><!--]--></a><!----></li><li><a href="/showns-vuepress/apply/middleware/MqCompare.html" class="sidebar-item" aria-label="MQ 的作用及主流 MQ 对比"><!--[--><!--]--> MQ 的作用及主流 MQ 对比 <!--[--><!--]--></a><!----></li><li><a href="/showns-vuepress/apply/middleware/RabbitMqBase.html" class="sidebar-item" aria-label="RabbitMQ - 安装及基础使用"><!--[--><!--]--> RabbitMQ - 安装及基础使用 <!--[--><!--]--></a><!----></li><li><a href="/showns-vuepress/apply/middleware/RabbitMqHighClass.html" class="sidebar-item" aria-label="RabbitMQ - 死信队列、延迟队列"><!--[--><!--]--> RabbitMQ - 死信队列、延迟队列 <!--[--><!--]--></a><!----></li><li><a href="/showns-vuepress/apply/middleware/RedisStudy.html" class="sidebar-item" aria-label="Redis 缓存 - 常见配置与应用案例"><!--[--><!--]--> Redis 缓存 - 常见配置与应用案例 <!--[--><!--]--></a><!----></li><!--]--></ul></li><li><p tabindex="0" class="sidebar-item sidebar-heading">工具 <!----></p><ul style="" class="sidebar-item-children"><!--[--><li><a href="/showns-vuepress/apply/tool/MysqldumpBackupSql.html" class="sidebar-item" aria-label="使用mysqldump定时备份sql"><!--[--><!--]--> 使用mysqldump定时备份sql <!--[--><!--]--></a><!----></li><li><a href="/showns-vuepress/apply/tool/JenkinsGiteeNpmBuild.html" class="sidebar-item" aria-label="Jenkins、Gitee 自动化部署"><!--[--><!--]--> Jenkins、Gitee 自动化部署 <!--[--><!--]--></a><!----></li><li><a href="/showns-vuepress/apply/tool/JenkinsMavenDockerfile.html" class="sidebar-item" aria-label="Jenkins、Dockerfile 容器部署"><!--[--><!--]--> Jenkins、Dockerfile 容器部署 <!--[--><!--]--></a><!----></li><!--]--></ul></li><li><p tabindex="0" class="sidebar-item sidebar-heading">散记 <!----></p><ul style="" class="sidebar-item-children"><!--[--><li><a href="/showns-vuepress/apply/fqa/SomethingNotes.html" class="sidebar-item" aria-label="发在语雀不配单独提出来"><!--[--><!--]--> 发在语雀不配单独提出来 <!--[--><!--]--></a><!----></li><li><a href="/showns-vuepress/apply/fqa/DubboZookeeperFirst.html" class="sidebar-item" aria-label="Dubbo3 + Zookeeper 基础案例"><!--[--><!--]--> Dubbo3 + Zookeeper 基础案例 <!--[--><!--]--></a><!----></li><li><a href="/showns-vuepress/apply/fqa/ExplainKeyColumn.html" class="sidebar-item" aria-label="使用 Explain 进行 SQL 分析"><!--[--><!--]--> 使用 Explain 进行 SQL 分析 <!--[--><!--]--></a><!----></li><li><a href="/showns-vuepress/apply/fqa/DockerGiteaMysql.html" class="sidebar-item" aria-label="Docker、Gitea、Mysql 企业仓库"><!--[--><!--]--> Docker、Gitea、Mysql 企业仓库 <!--[--><!--]--></a><!----></li><!--]--></ul></li><!--]--></ul><!--[--><!--]--></aside><!--]--><!--[--><main class="page"><!--[--><!--]--><div class="theme-default-content"><!--[--><!--]--><div><div class="catalog"><ul><li><a href="#%E5%89%8D%E8%A8%80">前言</a></li><li><a href="#BPMN">BPMN 流程定义</a></li><li><a href="#demo">Activiti7 基础Demo</a></li><li><a href="#api">Activiti 常用API</a></li><li><a href="#%E5%85%B7%E4%BD%93%E4%B8%9A%E5%8A%A1%E5%9C%BA%E6%99%AF%E5%AE%9E%E7%8E%B0">具体业务场景实现</a><ul><li><a href="#%E7%8E%AF%E5%A2%83%E5%87%86%E5%A4%87">环境准备</a></li><li><a href="#%E5%91%98%E5%B7%A5%E8%AF%B7%E5%81%87%E5%AE%A1%E6%89%B9">员工请假审批</a></li><li><a href="#%E5%91%98%E5%B7%A5%E7%A6%BB%E8%81%8C%E5%AE%A1%E6%89%B9">员工离职审批</a></li><li><a href="#%E8%B4%B9%E7%94%A8%E6%8A%A5%E9%94%80%E5%A4%9A%E4%BA%BA%E4%BC%9A%E7%AD%BE">费用报销多人会签</a></li><li><a href="#%E5%85%AC%E5%8F%B8%E7%BC%BA%E4%BA%BA%E7%A6%BB%E8%81%8C%E4%B8%8D%E6%89%B9">公司缺人离职不批</a></li><li><a href="#%E6%B5%81%E7%A8%8B%E7%AD%BE%E7%BD%B2%E8%87%AA%E5%8A%A8%E6%8F%90%E9%86%92">流程签署自动提醒</a></li></ul></li><li><a href="#%E5%85%B6%E4%BB%96%E5%8A%9F%E8%83%BD">其他功能</a></li><li><a href="#te">参考文章</a></li></ul></div><h2 id="前言" tabindex="-1"><a class="header-anchor" href="#前言" aria-hidden="true">#</a> <span id="前言">前言</span></h2><p><code>2022.02.25</code></p><p>工作流引擎算是个很好的工具，不过 activiti 组织变动后，不怎么给力了，更新也不积极了。</p><p>新的 flowable 听说还不错，不过因为目前项目用了activiti ，先试试水。</p><ul><li>官网文档：<a href="https://www.activiti.org/documentation" target="_blank" rel="noopener noreferrer">Documentation | Activiti<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></li><li>API文档：<a href="https://www.activiti.org/javadocs/" target="_blank" rel="noopener noreferrer">Overview (Activiti - Engine 5.22.0 API)<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></li><li>Github 地址：<a href="https://github.com/Activiti/Activiti" target="_blank" rel="noopener noreferrer">Activiti/Activiti<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></li></ul><p>工作流作用就不比比了，直接进入正题。总体的使用流程如下：</p><ol><li>使用 BPMN 建模工具，绘制业务流程图，它的本质是一个规范的 XML 文件</li><li>将业务流程图，导入到工作流引擎中，也就是存到数据库里</li><li>在业务系统中调用工作流引擎提供的接口</li></ol><p>把代码放上：</p><ul><li>绘图工具仓库地址：<a href="https://gitee.com/learning-use-cases/springboot-activiti7-modeler" target="_blank" rel="noopener noreferrer">Learning Use Cases/springboot-activiti7-modeler (gitee.com)<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></li><li>hello world仓库地址：<a href="https://gitee.com/learning-use-cases/activiti-first" target="_blank" rel="noopener noreferrer">Learning Use Cases/activiti-first (gitee.com)<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></li><li>完整业务流程案例：<a href="https://gitee.com/qianwei4712/code-of-shiva/tree/master/activiti" target="_blank" rel="noopener noreferrer">code of shiva - Gitee.com<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></li></ul><br><h2 id="bpmn-流程定义" tabindex="-1"><a class="header-anchor" href="#bpmn-流程定义" aria-hidden="true">#</a> <span id="BPMN">BPMN 流程定义</span></h2><p>首先，应该都见过工作流的流程图：</p><blockquote><p>BPMN（Business Process Model AndNotation）- 业务流程模型和符号，是一套标准的业务流程建模符号，使用BPMN提供的符号可以创建业务流程。</p></blockquote><p>网上有很多在线绘制网站，例如：</p><ul><li><a href="https://bpmn.52itstyle.vip/" target="_blank" rel="noopener noreferrer">BPMN在线作图工具 (52itstyle.vip)<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></li><li><a href="https://www.freedgo.com/" target="_blank" rel="noopener noreferrer">在线免费绘图工具 | 裕奥在线绘图工具Freedgo<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></li></ul><h3 id="bpmn-图形释义" tabindex="-1"><a class="header-anchor" href="#bpmn-图形释义" aria-hidden="true">#</a> BPMN 图形释义</h3><p><strong>事件（Event）</strong></p><p><strong>用一个圆圈表示</strong>，它是流程中运行过程中发生的事情。</p><p><img src="https://shiva.oss-cn-hangzhou.aliyuncs.com/picture-master/images/20201106094336416.png" alt="20201106094336416"></p><p><strong>活动（Activity）</strong></p><p><strong>活动用圆角矩形表示</strong>，一个流程由一个活动或多个活动组成</p><p><img src="https://shiva.oss-cn-hangzhou.aliyuncs.com/picture-master/images/clip_image002-1573894978125.jpg" alt="clip_image002-1573894978125"></p><p><img src="https://shiva.oss-cn-hangzhou.aliyuncs.com/picture-master/images/22111574562726375.png" alt="22111574562726375"></p><p><strong>网关 GateWay</strong></p><p>网关用来处理决策，有几种常用网关需要了解：</p><p><img src="https://shiva.oss-cn-hangzhou.aliyuncs.com/picture-master/images/1574563600305.png" alt=""></p><p>排他网关 (x)</p><p>——只有一条路径会被选择。流程执行到该网关时，按照输出流的顺序逐个计算，当条件的计算结果为true时，继续执行当前网关的输出流；</p><pre><code>如果多条线路计算结果都是 true，则会执行第一个值为 true 的线路。如果所有网关计算结果没有true，则引擎会抛出异常。
排他网关需要和条件顺序流结合使用，default 属性指定默认顺序流，当所有的条件不满足时会执行默认顺序流。
</code></pre><p>并行网关 (+)</p><p>——所有路径会被同时选择</p><pre><code>拆分 —— 并行执行所有输出顺序流，为每一条顺序流创建一个并行执行线路。
合并 —— 所有从并行网关拆分并执行完成的线路均在此等候，直到所有的线路都执行完成才继续向下执行。
</code></pre><p>包容网关 (+)</p><p>—— 可以同时执行多条线路，也可以在网关上设置条件</p><pre><code>拆分 —— 计算每条线路上的表达式，当表达式计算结果为true时，创建一个并行线路并继续执行
合并 —— 所有从并行网关拆分并执行完成的线路均在此等候，直到所有的线路都执行完成才继续向下执行。
</code></pre><p>事件网关 (+)</p><p>—— 专门为中间捕获事件设置的，允许设置多个输出流指向多个不同的中间捕获事件。当流程执行到事件网关后，流程处于等待状态，需要等待抛出事件才能将等待状态转换为活动状态。</p><p><strong>流向 Flow</strong></p><p>流是连接两个流程节点的连线。常见的流向包含以下几种：</p><p><img src="https://shiva.oss-cn-hangzhou.aliyuncs.com/picture-master/images/1574563937457.png" alt=""></p><h3 id="bpmn-本质" tabindex="-1"><a class="header-anchor" href="#bpmn-本质" aria-hidden="true">#</a> BPMN 本质</h3><p>在 <a href="https://bpmn.52itstyle.vip/" target="_blank" rel="noopener noreferrer">BPMN在线作图工具 (52itstyle.vip)<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a> 随便画了个图：</p><p><img src="https://shiva.oss-cn-hangzhou.aliyuncs.com/picture-master/images/image-20220225205812315.png" alt="image-20220225205812315"></p><p>下载后为 BPMN 文件后，文本模式打开，它的实际内容为一个 XML：</p><img src="https://shiva.oss-cn-hangzhou.aliyuncs.com/picture-master/images/image-20220225205919296.png" alt="image-20" style="zoom:70%;"><br><h2 id="activiti7-基础demo" tabindex="-1"><a class="header-anchor" href="#activiti7-基础demo" aria-hidden="true">#</a> <span id="demo">Activiti7 基础Demo</span></h2><p>代码第一步，整一个 hello world 出来。</p><p>这里涉及到两个工程，连一个数据库。</p><h3 id="环境准备" tabindex="-1"><a class="header-anchor" href="#环境准备" aria-hidden="true">#</a> 环境准备</h3><blockquote><p><strong>Demo 环境：JDK8 、SpringBoot 2.6.4 、mysql 、activiti 7</strong></p></blockquote><p>添加POM依赖：</p><div class="language-xml line-numbers-mode" data-ext="xml"><pre class="language-xml"><code> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
     <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.activiti<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
     <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>activiti-spring-boot-starter<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
     <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>7.0.0.SR1<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>application 添加 activiti 配置：</p><div class="language-yaml line-numbers-mode" data-ext="yml"><pre class="language-yaml"><code><span class="token key atrule">spring</span><span class="token punctuation">:</span>
  <span class="token key atrule">activiti</span><span class="token punctuation">:</span>
    <span class="token comment"># 线上环境用 false，不然出毛病就嗝屁了</span>
    <span class="token comment">#1.flase：默认值。activiti在启动时，对比数据库表中保存的版本，如果没有表或者版本不匹配，将抛出异常</span>
    <span class="token comment">#2.true： activiti会对数据库中所有表进行更新操作。如果表不存在，则自动创建</span>
    <span class="token comment">#3.create_drop： 在activiti启动时创建表，在关闭时删除表（必须手动关闭引擎，才能删除表）</span>
    <span class="token comment">#4.drop-create： 在activiti启动时删除原来的旧表，然后在创建新表（不需要手动关闭引擎）</span>
    <span class="token key atrule">database-schema-update</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
    <span class="token comment">#检测历史表是否存在 activiti7默认没有开启数据库历史记录 启动数据库历史记录</span>
    <span class="token key atrule">db-history-used</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
    <span class="token comment">#记录历史等级 可配置的历史级别有none, activity, audit, full</span>
    <span class="token comment">#none：不保存任何的历史数据，因此，在流程执行过程中，这是最高效的。</span>
    <span class="token comment">#activity：级别高于none，保存流程实例与流程行为，其他数据不保存。</span>
    <span class="token comment">#audit：除activity级别会保存的数据外，还会保存全部的流程任务及其属性。audit为history的默认值。</span>
    <span class="token comment">#full：保存历史数据的最高级别，除了会保存audit级别的数据外，还会保存其他全部流程相关的细节数据，包括一些流程参数等。</span>
    <span class="token key atrule">history-level</span><span class="token punctuation">:</span> full
    <span class="token comment">#校验流程文件，默认校验resources下的processes文件夹里的流程文件</span>
    <span class="token key atrule">check-process-definitions</span><span class="token punctuation">:</span> <span class="token boolean important">false</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>因为 activiti7 默认集成的权限框架是 SpringSecurity，所以先添加一个配置快速实现。</p><p>下面的两个配置都来自官方文档示例：</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@Component</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">SecurityUtil</span> <span class="token punctuation">{</span>
    <span class="token keyword">private</span> <span class="token class-name">Logger</span> logger <span class="token operator">=</span> <span class="token class-name">LoggerFactory</span><span class="token punctuation">.</span><span class="token function">getLogger</span><span class="token punctuation">(</span><span class="token class-name">SecurityUtil</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Autowired</span>
    <span class="token keyword">private</span> <span class="token class-name">UserDetailsService</span> userDetailsService<span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">logInAs</span><span class="token punctuation">(</span><span class="token class-name">String</span> username<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">UserDetails</span> user <span class="token operator">=</span> userDetailsService<span class="token punctuation">.</span><span class="token function">loadUserByUsername</span><span class="token punctuation">(</span>username<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">if</span> <span class="token punctuation">(</span>user <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">IllegalStateException</span><span class="token punctuation">(</span><span class="token string">&quot;User &quot;</span> <span class="token operator">+</span> username <span class="token operator">+</span> <span class="token string">&quot; doesn&#39;t exist, please provide a valid user&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        logger<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">&quot;&gt; Logged in as: &quot;</span> <span class="token operator">+</span> username<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token class-name">SecurityContextHolder</span><span class="token punctuation">.</span><span class="token function">setContext</span><span class="token punctuation">(</span>
                <span class="token keyword">new</span> <span class="token class-name">SecurityContextImpl</span><span class="token punctuation">(</span>
                        <span class="token keyword">new</span> <span class="token class-name">Authentication</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                            <span class="token annotation punctuation">@Override</span>
                            <span class="token keyword">public</span> <span class="token class-name">Collection</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span> <span class="token keyword">extends</span> <span class="token class-name">GrantedAuthority</span><span class="token punctuation">&gt;</span></span> <span class="token function">getAuthorities</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                                <span class="token keyword">return</span> user<span class="token punctuation">.</span><span class="token function">getAuthorities</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                            <span class="token punctuation">}</span>
                            <span class="token annotation punctuation">@Override</span>
                            <span class="token keyword">public</span> <span class="token class-name">Object</span> <span class="token function">getCredentials</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                                <span class="token keyword">return</span> user<span class="token punctuation">.</span><span class="token function">getPassword</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                            <span class="token punctuation">}</span>
                            <span class="token annotation punctuation">@Override</span>
                            <span class="token keyword">public</span> <span class="token class-name">Object</span> <span class="token function">getDetails</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                                <span class="token keyword">return</span> user<span class="token punctuation">;</span>
                            <span class="token punctuation">}</span>
                            <span class="token annotation punctuation">@Override</span>
                            <span class="token keyword">public</span> <span class="token class-name">Object</span> <span class="token function">getPrincipal</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                                <span class="token keyword">return</span> user<span class="token punctuation">;</span>
                            <span class="token punctuation">}</span>
                            <span class="token annotation punctuation">@Override</span>
                            <span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">isAuthenticated</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                                <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
                            <span class="token punctuation">}</span>
                            <span class="token annotation punctuation">@Override</span>
                            <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setAuthenticated</span><span class="token punctuation">(</span><span class="token keyword">boolean</span> isAuthenticated<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IllegalArgumentException</span> <span class="token punctuation">{</span>
                            <span class="token punctuation">}</span>
                            <span class="token annotation punctuation">@Override</span>
                            <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                                <span class="token keyword">return</span> user<span class="token punctuation">.</span><span class="token function">getUsername</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                            <span class="token punctuation">}</span>
                        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name"><span class="token namespace">org<span class="token punctuation">.</span>activiti<span class="token punctuation">.</span>engine<span class="token punctuation">.</span>impl<span class="token punctuation">.</span>identity<span class="token punctuation">.</span></span>Authentication</span><span class="token punctuation">.</span><span class="token function">setAuthenticatedUserId</span><span class="token punctuation">(</span>username<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>添加用户以及权限信息：</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@Configuration</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">PermissionsConfiguration</span> <span class="token punctuation">{</span>
    <span class="token keyword">private</span> <span class="token class-name">Logger</span> logger <span class="token operator">=</span> <span class="token class-name">LoggerFactory</span><span class="token punctuation">.</span><span class="token function">getLogger</span><span class="token punctuation">(</span><span class="token class-name">PermissionsConfiguration</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token annotation punctuation">@Bean</span>
    <span class="token keyword">public</span> <span class="token class-name">UserDetailsService</span> <span class="token function">myUserDetailsService</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">InMemoryUserDetailsManager</span> inMemoryUserDetailsManager <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">InMemoryUserDetailsManager</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//这里添加用户，后面处理流程时用到的任务负责人，需要添加在这里</span>
        <span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token punctuation">]</span> usersGroupsAndRoles <span class="token operator">=</span> <span class="token punctuation">{</span>
                <span class="token punctuation">{</span><span class="token string">&quot;jack&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;password&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;ROLE_ACTIVITI_USER&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;GROUP_activitiTeam&quot;</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
                <span class="token punctuation">{</span><span class="token string">&quot;rose&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;password&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;ROLE_ACTIVITI_USER&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;GROUP_activitiTeam&quot;</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
                <span class="token punctuation">{</span><span class="token string">&quot;tom&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;password&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;ROLE_ACTIVITI_USER&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;GROUP_activitiTeam&quot;</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
                <span class="token punctuation">{</span><span class="token string">&quot;other&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;password&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;ROLE_ACTIVITI_USER&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;GROUP_otherTeam&quot;</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
                <span class="token punctuation">{</span><span class="token string">&quot;system&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;password&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;ROLE_ACTIVITI_USER&quot;</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
                <span class="token punctuation">{</span><span class="token string">&quot;admin&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;password&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;ROLE_ACTIVITI_ADMIN&quot;</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">;</span>

        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> user <span class="token operator">:</span> usersGroupsAndRoles<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> authoritiesStrings <span class="token operator">=</span> <span class="token class-name">Arrays</span><span class="token punctuation">.</span><span class="token function">asList</span><span class="token punctuation">(</span><span class="token class-name">Arrays</span><span class="token punctuation">.</span><span class="token function">copyOfRange</span><span class="token punctuation">(</span>user<span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> user<span class="token punctuation">.</span>length<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            logger<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">&quot;&gt; Registering new user: &quot;</span> <span class="token operator">+</span> user<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">+</span> <span class="token string">&quot; with the following Authorities[&quot;</span> <span class="token operator">+</span> authoritiesStrings <span class="token operator">+</span> <span class="token string">&quot;]&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            inMemoryUserDetailsManager<span class="token punctuation">.</span><span class="token function">createUser</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">User</span><span class="token punctuation">(</span>user<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token function">passwordEncoder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">encode</span><span class="token punctuation">(</span>user<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                    authoritiesStrings<span class="token punctuation">.</span><span class="token function">stream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token class-name">SimpleGrantedAuthority</span><span class="token operator">::</span><span class="token keyword">new</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">collect</span><span class="token punctuation">(</span><span class="token class-name">Collectors</span><span class="token punctuation">.</span><span class="token function">toList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">return</span> inMemoryUserDetailsManager<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token annotation punctuation">@Bean</span>
    <span class="token keyword">public</span> <span class="token class-name">PasswordEncoder</span> <span class="token function">passwordEncoder</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">BCryptPasswordEncoder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><br><h3 id="bpmn-导入" tabindex="-1"><a class="header-anchor" href="#bpmn-导入" aria-hidden="true">#</a> BPMN 导入</h3><p>这里加点新东西，<strong>activiti modeler 设计器，这是一个可以集成在项目里，绘制部署全套流程的界面化工具</strong>。</p><p>一步一步来，这里先使用独立版，到后面再整合：</p><ul><li>绘图工具仓库地址：<a href="https://gitee.com/learning-use-cases/springboot-activiti7-modeler" target="_blank" rel="noopener noreferrer">Learning Use Cases/springboot-activiti7-modeler (gitee.com)<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></li><li>测试Demo仓库地址：<a href="https://gitee.com/learning-use-cases/activiti-first" target="_blank" rel="noopener noreferrer">Learning Use Cases/activiti-first (gitee.com)<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></li></ul><p>这个小 Demo 有部署接口文档，设计器图形界面两部分，详细自己看 readme。</p><p><img src="https://shiva.oss-cn-hangzhou.aliyuncs.com/picture-master/images/image-20220302113612122.png" alt=""></p><p><img src="https://shiva.oss-cn-hangzhou.aliyuncs.com/picture-master/images/image-20220302174903889.png" alt=""></p><p>在设计器中绘制了一个简单流程，然后保存后自动解析存入数据库</p><p><img src="https://shiva.oss-cn-hangzhou.aliyuncs.com/picture-master/images/image-20220302154431883.png" alt=""></p><p>顺便指定审批人</p><img src="https://shiva.oss-cn-hangzhou.aliyuncs.com/picture-master/images/image-20220302173319777.png" style="zoom:80%;"><p><img src="https://shiva.oss-cn-hangzhou.aliyuncs.com/picture-master/images/image-20220302154533325.png" alt=""></p><p>顺便调用一下手动部署的接口</p><p><img src="https://shiva.oss-cn-hangzhou.aliyuncs.com/picture-master/images/image-20220302161053179.png" alt=""></p><br><h3 id="单元测试" tabindex="-1"><a class="header-anchor" href="#单元测试" aria-hidden="true">#</a> 单元测试</h3><p>测试主要流程如下：</p><p><img src="https://shiva.oss-cn-hangzhou.aliyuncs.com/picture-master/images/image-20220302234513397.png" alt=""></p><p>模型部署已经在上一步完成，这里直接查询流程定义并启动，然后进行任务审批。</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@RunWith</span><span class="token punctuation">(</span><span class="token class-name">SpringRunner</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@SpringBootTest</span>
<span class="token keyword">class</span> <span class="token class-name">ActivitiFirstApplicationTests</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Autowired</span>
    <span class="token keyword">private</span> <span class="token class-name">ProcessRuntime</span> processRuntime<span class="token punctuation">;</span>
    <span class="token annotation punctuation">@Autowired</span>
    <span class="token keyword">private</span> <span class="token class-name">TaskRuntime</span> taskRuntime<span class="token punctuation">;</span>
    <span class="token annotation punctuation">@Autowired</span>
    <span class="token keyword">private</span> <span class="token class-name">SecurityUtil</span> securityUtil<span class="token punctuation">;</span>

    <span class="token doc-comment comment">/**
     * 查看流程定义
     */</span>
    <span class="token annotation punctuation">@Test</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">contextLoads</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        securityUtil<span class="token punctuation">.</span><span class="token function">logInAs</span><span class="token punctuation">(</span><span class="token string">&quot;system&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Page</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">ProcessDefinition</span><span class="token punctuation">&gt;</span></span> processDefinitionPage <span class="token operator">=</span>
                processRuntime<span class="token punctuation">.</span><span class="token function">processDefinitions</span><span class="token punctuation">(</span><span class="token class-name">Pageable</span><span class="token punctuation">.</span><span class="token function">of</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;可用的流程定义数量：&quot;</span> <span class="token operator">+</span> processDefinitionPage<span class="token punctuation">.</span><span class="token function">getTotalItems</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name"><span class="token namespace">org<span class="token punctuation">.</span>activiti<span class="token punctuation">.</span>api<span class="token punctuation">.</span>process<span class="token punctuation">.</span>model<span class="token punctuation">.</span></span>ProcessDefinition</span> pd <span class="token operator">:</span> processDefinitionPage<span class="token punctuation">.</span><span class="token function">getContent</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;流程定义：&quot;</span> <span class="token operator">+</span> pd<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token doc-comment comment">/**
     * 启动流程实例
     */</span>
    <span class="token annotation punctuation">@Test</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">testStartProcess</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        securityUtil<span class="token punctuation">.</span><span class="token function">logInAs</span><span class="token punctuation">(</span><span class="token string">&quot;system&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">ProcessInstance</span> pi <span class="token operator">=</span> processRuntime<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token class-name">ProcessPayloadBuilder</span><span class="token punctuation">.</span>
                <span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>
                <span class="token function">withProcessDefinitionKey</span><span class="token punctuation">(</span><span class="token string">&quot;hello_activiti&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>
                <span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;流程实例ID：&quot;</span> <span class="token operator">+</span> pi<span class="token punctuation">.</span><span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>


    <span class="token doc-comment comment">/**
     * *查询任务，并完成自己的任务
     **/</span>
    <span class="token annotation punctuation">@Test</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">testTask</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        securityUtil<span class="token punctuation">.</span><span class="token function">logInAs</span><span class="token punctuation">(</span><span class="token string">&quot;jack&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Page</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Task</span><span class="token punctuation">&gt;</span></span> taskPage <span class="token operator">=</span> taskRuntime<span class="token punctuation">.</span><span class="token function">tasks</span><span class="token punctuation">(</span><span class="token class-name">Pageable</span><span class="token punctuation">.</span><span class="token function">of</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>taskPage<span class="token punctuation">.</span><span class="token function">getTotalItems</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">Task</span> task <span class="token operator">:</span> taskPage<span class="token punctuation">.</span><span class="token function">getContent</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                taskRuntime<span class="token punctuation">.</span><span class="token function">claim</span><span class="token punctuation">(</span><span class="token class-name">TaskPayloadBuilder</span><span class="token punctuation">.</span>
                        <span class="token function">claim</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>
                        <span class="token function">withTaskId</span><span class="token punctuation">(</span>task<span class="token punctuation">.</span><span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;任务：&quot;</span> <span class="token operator">+</span> task<span class="token punctuation">)</span><span class="token punctuation">;</span>
                taskRuntime<span class="token punctuation">.</span><span class="token function">complete</span><span class="token punctuation">(</span><span class="token class-name">TaskPayloadBuilder</span><span class="token punctuation">.</span>
                        <span class="token function">complete</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>
                        <span class="token function">withTaskId</span><span class="token punctuation">(</span>task<span class="token punctuation">.</span><span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
        <span class="token class-name">Page</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Task</span><span class="token punctuation">&gt;</span></span> taskPage2 <span class="token operator">=</span> taskRuntime<span class="token punctuation">.</span><span class="token function">tasks</span><span class="token punctuation">(</span><span class="token class-name">Pageable</span><span class="token punctuation">.</span><span class="token function">of</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>taskPage2<span class="token punctuation">.</span><span class="token function">getTotalItems</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;任务：&quot;</span> <span class="token operator">+</span> taskPage2<span class="token punctuation">.</span><span class="token function">getContent</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><img src="https://shiva.oss-cn-hangzhou.aliyuncs.com/picture-master/images/image-20220302202033846.png" alt=""></p><br><h3 id="activiti-表结构" tabindex="-1"><a class="header-anchor" href="#activiti-表结构" aria-hidden="true">#</a> Activiti 表结构</h3><p>上面的配置中写了自动建表，可以在数据库里看到相应的表和记录。</p><p>看到刚才创建的表，我们发现Activiti 的表都以 <code>ACT_</code> 开头。 第二部分是表示表的用途的两个字母标识。 用途也和服务的 API 对应。</p><ul><li><strong>ACT_RE</strong> ：&#39;RE&#39; 表示 repository。 这个前缀的表包含了流程定义和流程静态资源 （图片，规则，等等）。</li><li><strong>ACT_RU</strong> ：&#39;RU&#39; 表示 runtime。 这些运行时的表，包含流程实例，任务，变量，异步任务，等运行中的数据。 Activiti 只在流程实例执行过程中保存这些数据， 在流程结束时就会删除这些记录。 这样运行时表可以一直很小速度很快。</li><li><strong>ACT_HI</strong> ：&#39;HI&#39; 表示 history。 这些表包含历史数据，比如历史流程实例， 变量，任务等等。</li><li><strong>ACT_GE</strong> ：&#39;GE&#39; 表示 general。 通用数据， 用于不同场景下</li></ul><table><thead><tr><th><strong>表分类</strong></th><th><strong>表名</strong></th><th><strong>解释</strong></th></tr></thead><tbody><tr><td>一般数据</td><td></td><td></td></tr><tr><td></td><td>[ACT_GE_BYTEARRAY]</td><td>通用的流程定义和流程资源，xml文件详细信息在这里</td></tr><tr><td></td><td>[ACT_GE_PROPERTY]</td><td>系统相关属性</td></tr><tr><td>流程历史记录</td><td></td><td></td></tr><tr><td></td><td>[ACT_HI_ACTINST]</td><td>历史的流程实例</td></tr><tr><td></td><td>[ACT_HI_ATTACHMENT]</td><td>历史的流程附件</td></tr><tr><td></td><td>[ACT_HI_COMMENT]</td><td>历史的说明性信息</td></tr><tr><td></td><td>[ACT_HI_DETAIL]</td><td>历史的流程运行中的细节信息</td></tr><tr><td></td><td>[ACT_HI_IDENTITYLINK]</td><td>历史的流程运行过程中用户关系</td></tr><tr><td></td><td>[ACT_HI_PROCINST]</td><td>历史的流程实例</td></tr><tr><td></td><td>[ACT_HI_TASKINST]</td><td>历史的任务实例，记录所有任务</td></tr><tr><td></td><td>[ACT_HI_VARINST]</td><td>历史的流程运行中的变量信息</td></tr><tr><td>流程定义表</td><td></td><td></td></tr><tr><td></td><td>[ACT_RE_DEPLOYMENT]</td><td>部署单元信息，每部署一次增加一条记录</td></tr><tr><td></td><td>[ACT_RE_MODEL]</td><td>模型信息</td></tr><tr><td></td><td>[ACT_RE_PROCDEF]</td><td>已部署的流程定义，部署每个新的流程定义都会在这张表中增加一条记录</td></tr><tr><td>运行实例表</td><td></td><td></td></tr><tr><td></td><td>[ACT_RU_EVENT_SUBSCR]</td><td>运行时事件</td></tr><tr><td></td><td>[ACT_RU_EXECUTION]</td><td>运行时流程执行实例，记录当前流程实例的执行情况</td></tr><tr><td></td><td>[ACT_RU_IDENTITYLINK]</td><td>运行时用户关系信息，存储任务节点与参与者的相关信息，记录当前参与任务的用户或组</td></tr><tr><td></td><td>[ACT_RU_JOB]</td><td>运行时作业</td></tr><tr><td></td><td>[ACT_RU_TASK]</td><td>运行时任务，记录当前执行的任务</td></tr><tr><td></td><td>[ACT_RU_VARIABLE]</td><td>运行时变量表</td></tr></tbody></table><br><h2 id="activiti-常用api" tabindex="-1"><a class="header-anchor" href="#activiti-常用api" aria-hidden="true">#</a> <span id="api">Activiti 常用API</span></h2><p>这也是个老图了，和新版有点区别，不过无所谓了。</p><p><img src="https://shiva.oss-cn-hangzhou.aliyuncs.com/picture-master/images/clip_image002.jpg" alt="clip_image002"></p><p>总体来说，API 分为 <strong>引擎</strong> 和 <strong>服务</strong> 两部分。</p><p>一般项目中，通常是通过引擎拿到服务，不过对现在都是 spring 整合后的，processEngine 对象来负责创建 Service 对象，直接注入使用。</p><h3 id="引擎创建" tabindex="-1"><a class="header-anchor" href="#引擎创建" aria-hidden="true">#</a> 引擎创建</h3><p>在一般项目中，我们都是用配置文件读取：</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token comment">//直接使用工具类 ProcessEngines，使用classpath下的activiti.cfg.xml中的配置创建processEngine</span>
<span class="token class-name">ProcessEngine</span> processEngine <span class="token operator">=</span> <span class="token class-name">ProcessEngines</span><span class="token punctuation">.</span><span class="token function">getDefaultProcessEngine</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>processEngine<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token comment">//先构建ProcessEngineConfiguration</span>
<span class="token class-name">ProcessEngineConfiguration</span> configuration <span class="token operator">=</span> <span class="token class-name">ProcessEngineConfiguration</span><span class="token punctuation">.</span><span class="token function">createProcessEngineConfigurationFromResource</span><span class="token punctuation">(</span><span class="token string">&quot;activiti.cfg.xml&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//通过ProcessEngineConfiguration创建ProcessEngine，此时会创建数据库</span>
<span class="token class-name">ProcessEngine</span> processEngine <span class="token operator">=</span> configuration<span class="token punctuation">.</span><span class="token function">buildProcessEngine</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>不过对 SpringBoot 整合后来说，直接注入就行。</strong></p><h3 id="服务调用" tabindex="-1"><a class="header-anchor" href="#服务调用" aria-hidden="true">#</a> 服务调用</h3><p>Activiti 核心服务类，就下面几个：</p><table><thead><tr><th>service名称</th><th>service作用</th></tr></thead><tbody><tr><td><strong>RepositoryService</strong></td><td><strong>是activiti的资源管理类，提供了管理和控制流程发布包和流程定义的操作。使用工作流建模工具设计的业务流程图需要使用此service将流程定义文件的内容部署到计算机。</strong></td></tr><tr><td>RuntimeService</td><td>Activiti的流程运行管理类。可以从这个服务类中获取很多关于流程执行相关的信息</td></tr><tr><td>TaskService</td><td>Activiti的任务管理类。可以从这个类中获取任务的信息。</td></tr><tr><td>HistoryService</td><td>Activiti的历史管理类，可以查询历史信息，执行流程时，引擎会保存很多数据（根据配置）。比如流程实例启动时间，任务的参与者， 完成任务的时间，每个流程实例的执行路径，等等</td></tr><tr><td>ManagerService</td><td>Activiti的引擎管理类，提供了对 Activiti 流程引擎的管理和维护功能，这些功能不在工作流驱动的应用程序中使用，主要用于 Activiti 系统的日常维护。</td></tr></tbody></table><h4 id="启动流程" tabindex="-1"><a class="header-anchor" href="#启动流程" aria-hidden="true">#</a> 启动流程</h4><p><strong>根据已经部署的流程定义，创建一个工作流任务</strong></p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token comment">// 根据流程定义Id启动流程</span>
<span class="token class-name">ProcessInstance</span> processInstance <span class="token operator">=</span> runtimeService<span class="token punctuation">.</span><span class="token function">startProcessInstanceByKey</span><span class="token punctuation">(</span><span class="token string">&quot;hello_activiti&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">ProcessInstance</span> pi <span class="token operator">=</span> processRuntime<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token class-name">ProcessPayloadBuilder</span><span class="token punctuation">.</span>
                                          <span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>
                                          <span class="token function">withProcessDefinitionKey</span><span class="token punctuation">(</span><span class="token string">&quot;hello_activiti&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>
                                          <span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="任务查询" tabindex="-1"><a class="header-anchor" href="#任务查询" aria-hidden="true">#</a> 任务查询</h4><p><strong>根据当前用户，查询未处理任务列表</strong></p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token comment">// 根据流程key 和 任务负责人 查询任务</span>
<span class="token class-name">String</span> assignee <span class="token operator">=</span> <span class="token string">&quot;zhangsan&quot;</span><span class="token punctuation">;</span>
<span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Task</span><span class="token punctuation">&gt;</span></span> list <span class="token operator">=</span> taskService<span class="token punctuation">.</span><span class="token function">createTaskQuery</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">processDefinitionKey</span><span class="token punctuation">(</span><span class="token string">&quot;myEvection&quot;</span><span class="token punctuation">)</span> <span class="token comment">//流程Key</span>
    <span class="token punctuation">.</span><span class="token function">taskAssignee</span><span class="token punctuation">(</span>assignee<span class="token punctuation">)</span><span class="token comment">//只查询该任务负责人的任务</span>
    <span class="token punctuation">.</span><span class="token function">list</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 分页查询</span>
securityUtil<span class="token punctuation">.</span><span class="token function">logInAs</span><span class="token punctuation">(</span><span class="token string">&quot;jack&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">Page</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Task</span><span class="token punctuation">&gt;</span></span> taskPage <span class="token operator">=</span> taskRuntime<span class="token punctuation">.</span><span class="token function">tasks</span><span class="token punctuation">(</span><span class="token class-name">Pageable</span><span class="token punctuation">.</span><span class="token function">of</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="任务处理" tabindex="-1"><a class="header-anchor" href="#任务处理" aria-hidden="true">#</a> 任务处理</h4><p><strong>处理指定任务</strong></p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token comment">// 完成任务,参数：任务id，varibles增量更新变量</span>
taskService<span class="token punctuation">.</span><span class="token function">complete</span><span class="token punctuation">(</span>task<span class="token punctuation">.</span><span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
taskService<span class="token punctuation">.</span><span class="token function">complete</span><span class="token punctuation">(</span>task<span class="token punctuation">.</span><span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> variables<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="历史审批查询" tabindex="-1"><a class="header-anchor" href="#历史审批查询" aria-hidden="true">#</a> 历史审批查询</h4><p><strong>查询已经完成审批的历史记录</strong></p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token comment">// 获取引擎</span>
<span class="token class-name">ProcessEngine</span> processEngine <span class="token operator">=</span> <span class="token class-name">ProcessEngines</span><span class="token punctuation">.</span><span class="token function">getDefaultProcessEngine</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 获取HistoryService</span>
<span class="token class-name">HistoryService</span> historyService <span class="token operator">=</span> processEngine<span class="token punctuation">.</span><span class="token function">getHistoryService</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 获取 actinst表的查询对象</span>
<span class="token class-name">HistoricActivityInstanceQuery</span> instanceQuery <span class="token operator">=</span> historyService<span class="token punctuation">.</span><span class="token function">createHistoricActivityInstanceQuery</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 查询 actinst表，条件：根据 InstanceId 查询</span>
<span class="token comment">// instanceQuery.processInstanceId(&quot;2501&quot;);</span>
<span class="token comment">// 查询 actinst表，条件：根据 DefinitionId 查询</span>
instanceQuery<span class="token punctuation">.</span><span class="token function">processDefinitionId</span><span class="token punctuation">(</span><span class="token string">&quot;myEvection:1:4&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 增加排序操作,orderByHistoricActivityInstanceStartTime 根据开始时间排序 asc 升序</span>
instanceQuery<span class="token punctuation">.</span><span class="token function">orderByHistoricActivityInstanceStartTime</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">asc</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 查询所有内容</span>
<span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">HistoricActivityInstance</span><span class="token punctuation">&gt;</span></span> activityInstanceList <span class="token operator">=</span> instanceQuery<span class="token punctuation">.</span><span class="token function">list</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="流程定义查询" tabindex="-1"><a class="header-anchor" href="#流程定义查询" aria-hidden="true">#</a> 流程定义查询</h4><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token comment">// repositoryService</span>
<span class="token class-name">RepositoryService</span> repositoryService <span class="token operator">=</span> processEngine<span class="token punctuation">.</span><span class="token function">getRepositoryService</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 得到ProcessDefinitionQuery 对象</span>
<span class="token class-name">ProcessDefinitionQuery</span> processDefinitionQuery <span class="token operator">=</span> repositoryService<span class="token punctuation">.</span><span class="token function">createProcessDefinitionQuery</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//  查询出当前所有的流程定义</span>
<span class="token comment">//  条件：processDefinitionKey =evection</span>
<span class="token comment">//          orderByProcessDefinitionVersion 按照版本排序</span>
<span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">ProcessDefinition</span><span class="token punctuation">&gt;</span></span> definitionList <span class="token operator">=</span> processDefinitionQuery<span class="token punctuation">.</span><span class="token function">processDefinitionKey</span><span class="token punctuation">(</span><span class="token string">&quot;myEvection&quot;</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">orderByProcessDefinitionVersion</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">desc</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">list</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="流程删除" tabindex="-1"><a class="header-anchor" href="#流程删除" aria-hidden="true">#</a> 流程删除</h4><p><strong>删除定义的审批流程</strong></p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token comment">// 流程部署id</span>
<span class="token class-name">String</span> deploymentId <span class="token operator">=</span> <span class="token string">&quot;1&quot;</span><span class="token punctuation">;</span>

<span class="token class-name">ProcessEngine</span> processEngine <span class="token operator">=</span> <span class="token class-name">ProcessEngines</span><span class="token punctuation">.</span><span class="token function">getDefaultProcessEngine</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 通过流程引擎获取repositoryService</span>
<span class="token class-name">RepositoryService</span> repositoryService <span class="token operator">=</span> processEngine
    <span class="token punctuation">.</span><span class="token function">getRepositoryService</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//删除流程定义，如果该流程定义已有流程实例启动则删除时出错</span>
repositoryService<span class="token punctuation">.</span><span class="token function">deleteDeployment</span><span class="token punctuation">(</span>deploymentId<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//设置true 级联删除流程定义，即使该流程有流程实例启动也可以删除，设置为false非级别删除方式，如果流程</span>
<span class="token comment">//repositoryService.deleteDeployment(deploymentId, true);</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><blockquote><ol><li>使用repositoryService删除流程定义，历史表信息不会被删除</li><li>如果该流程定义下没有正在运行的流程，则可以用普通删除。</li><li>如果该流程定义下存在已经运行的流程，使用普通删除报错，可用级联删除方法将流程及相关记录全部删除。 <ol><li>先删除没有完成流程节点，最后就可以完全删除流程定义信息</li><li>项目开发中级联删除操作一般只开放给超级管理员使用.</li></ol></li></ol></blockquote><br><h2 id="具体业务场景实现" tabindex="-1"><a class="header-anchor" href="#具体业务场景实现" aria-hidden="true">#</a> <span id="具体业务场景实现">具体业务场景实现</span></h2><p>工作流的基础使用方式，现在开始要和企业业务进行关联。</p><ul><li>代码仓库：<a href="https://gitee.com/qianwei4712/code-of-shiva/tree/master/activiti" target="_blank" rel="noopener noreferrer">code of shiva - Gitee.com<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></li></ul><p>首先要理解：</p><blockquote><ol><li><strong>Activiti 引擎只能操作它自己的相关表</strong></li><li><strong>工作流相关表，只存储流程相关信息，不存储任何业务信息，例如：业务单号、业务发生时间、业务审批通过后的后续操作等</strong></li></ol></blockquote><p>所以在业务系统中嵌入工作流，要配合业务表。</p><p><img src="https://shiva.oss-cn-hangzhou.aliyuncs.com/picture-master/images/image-20220312131549059.png" alt=""></p><p>当然了，这种关联关系，工作流肯定已经给我们预留好了：</p><p>在 <strong>表ACT_RU_EXECUTION 运行时流程执行实例</strong> 里，有一个 <strong>BUSINESS_KEY_</strong> 字段，可以用来存放关联业务信息字段。</p><p>现在来模拟实现以下几个场景：</p><ol><li>员工请假审批（通配、完成任务）</li><li>员工离职审批（拒绝申请、审批回调）</li><li>费用报销多人会签（多人同时审批）</li><li>公司缺人离职不批（流程挂起）</li><li>流程签署自动提醒（监听器）</li></ol><br><h3 id="环境准备-1" tabindex="-1"><a class="header-anchor" href="#环境准备-1" aria-hidden="true">#</a> <span id="环境准备">环境准备</span></h3><p>先做下准备工作，表就不建太多了。。。什么请假表、离职表这些都省略，直接作为 json 保存到 remarks</p><p>用 mybatis-plus，减少代码量。</p><p>比如有下面这个请假表字段：</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@Data</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">AskLeaf</span> <span class="token keyword">implements</span> <span class="token class-name">Serializable</span> <span class="token punctuation">{</span>
    <span class="token comment">//申请人</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> applicant<span class="token punctuation">;</span>
    <span class="token comment">//申请原因</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> reason<span class="token punctuation">;</span>
    <span class="token comment">//申请时间</span>
    <span class="token keyword">private</span> <span class="token class-name">Date</span> applyTime<span class="token punctuation">;</span>
    <span class="token comment">//请假时间，日期</span>
    <span class="token keyword">private</span> <span class="token class-name">Date</span> leafTime<span class="token punctuation">;</span>
    <span class="token comment">//审批时间</span>
    <span class="token keyword">private</span> <span class="token class-name">Date</span> approvalTime<span class="token punctuation">;</span>
    <span class="token comment">//最终审批人</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> finalApprover<span class="token punctuation">;</span>
    <span class="token comment">//审批状态; 0-审批中，1-通过，2-未通过</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> status<span class="token punctuation">;</span>
    <span class="token comment">//审批备注</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> remarks<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>显然，我们无法把这些字段保存到工作流的表里。</p><p>其次，我们需要对多种审批流进行管理，还需要一个专门为审批流而设计的一个表：</p><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code><span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> <span class="token identifier"><span class="token punctuation">`</span>act_process<span class="token punctuation">`</span></span> <span class="token punctuation">(</span>
  <span class="token identifier"><span class="token punctuation">`</span>id<span class="token punctuation">`</span></span> <span class="token keyword">bigint</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">AUTO_INCREMENT</span> <span class="token keyword">COMMENT</span> <span class="token string">&#39;流程id&#39;</span><span class="token punctuation">,</span>
  <span class="token identifier"><span class="token punctuation">`</span>instance_id<span class="token punctuation">`</span></span> <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">50</span><span class="token punctuation">)</span> <span class="token keyword">DEFAULT</span> <span class="token boolean">NULL</span> <span class="token keyword">COMMENT</span> <span class="token string">&#39;工作流实例id&#39;</span><span class="token punctuation">,</span>
  <span class="token identifier"><span class="token punctuation">`</span>process_no<span class="token punctuation">`</span></span> <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">50</span><span class="token punctuation">)</span> <span class="token keyword">DEFAULT</span> <span class="token boolean">NULL</span> <span class="token keyword">COMMENT</span> <span class="token string">&#39;流程编号&#39;</span><span class="token punctuation">,</span>
  <span class="token identifier"><span class="token punctuation">`</span>process_type<span class="token punctuation">`</span></span> <span class="token keyword">tinyint</span> <span class="token keyword">DEFAULT</span> <span class="token boolean">NULL</span> <span class="token keyword">COMMENT</span> <span class="token string">&#39;流程业务类型&#39;</span><span class="token punctuation">,</span>
  <span class="token identifier"><span class="token punctuation">`</span>process_name<span class="token punctuation">`</span></span> <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">50</span><span class="token punctuation">)</span> <span class="token keyword">DEFAULT</span> <span class="token boolean">NULL</span> <span class="token keyword">COMMENT</span> <span class="token string">&#39;流程名称&#39;</span><span class="token punctuation">,</span>
  <span class="token identifier"><span class="token punctuation">`</span>relation_bus_no<span class="token punctuation">`</span></span> <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">50</span><span class="token punctuation">)</span> <span class="token keyword">CHARACTER</span> <span class="token keyword">SET</span> utf8mb4 <span class="token keyword">COLLATE</span> utf8mb4_0900_ai_ci <span class="token keyword">DEFAULT</span> <span class="token boolean">NULL</span> <span class="token keyword">COMMENT</span> <span class="token string">&#39;关联业务单号&#39;</span><span class="token punctuation">,</span>
  <span class="token identifier"><span class="token punctuation">`</span>business_key<span class="token punctuation">`</span></span> <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">36</span><span class="token punctuation">)</span> <span class="token keyword">CHARACTER</span> <span class="token keyword">SET</span> utf8mb4 <span class="token keyword">COLLATE</span> utf8mb4_0900_ai_ci <span class="token keyword">DEFAULT</span> <span class="token boolean">NULL</span> <span class="token keyword">COMMENT</span> <span class="token string">&#39;关联业务单id&#39;</span><span class="token punctuation">,</span>
  <span class="token identifier"><span class="token punctuation">`</span>apply_user<span class="token punctuation">`</span></span> <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">50</span><span class="token punctuation">)</span> <span class="token keyword">DEFAULT</span> <span class="token boolean">NULL</span> <span class="token keyword">COMMENT</span> <span class="token string">&#39;流程申请人&#39;</span><span class="token punctuation">,</span>
  <span class="token identifier"><span class="token punctuation">`</span>start_time<span class="token punctuation">`</span></span> <span class="token keyword">datetime</span> <span class="token keyword">DEFAULT</span> <span class="token boolean">NULL</span> <span class="token keyword">COMMENT</span> <span class="token string">&#39;流程开始时间&#39;</span><span class="token punctuation">,</span>
  <span class="token identifier"><span class="token punctuation">`</span>end_time<span class="token punctuation">`</span></span> <span class="token keyword">datetime</span> <span class="token keyword">DEFAULT</span> <span class="token boolean">NULL</span> <span class="token keyword">COMMENT</span> <span class="token string">&#39;流程结束时间&#39;</span><span class="token punctuation">,</span>
  <span class="token identifier"><span class="token punctuation">`</span>is_agree<span class="token punctuation">`</span></span> <span class="token keyword">tinyint</span> <span class="token keyword">DEFAULT</span> <span class="token string">&#39;1&#39;</span> <span class="token keyword">COMMENT</span> <span class="token string">&#39;最终审批结果&#39;</span><span class="token punctuation">,</span>
  <span class="token identifier"><span class="token punctuation">`</span>status<span class="token punctuation">`</span></span> <span class="token keyword">tinyint</span> <span class="token keyword">DEFAULT</span> <span class="token string">&#39;0&#39;</span> <span class="token keyword">COMMENT</span> <span class="token string">&#39;状态&#39;</span><span class="token punctuation">,</span>
  <span class="token identifier"><span class="token punctuation">`</span>apply_reason<span class="token punctuation">`</span></span> <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">1024</span><span class="token punctuation">)</span> <span class="token keyword">DEFAULT</span> <span class="token string">&#39;0&#39;</span> <span class="token keyword">COMMENT</span> <span class="token string">&#39;申请审批原因&#39;</span><span class="token punctuation">,</span>
  <span class="token identifier"><span class="token punctuation">`</span>final_assignee<span class="token punctuation">`</span></span> <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">50</span><span class="token punctuation">)</span> <span class="token keyword">DEFAULT</span> <span class="token boolean">NULL</span> <span class="token keyword">COMMENT</span> <span class="token string">&#39;终审处理人&#39;</span><span class="token punctuation">,</span>
  <span class="token identifier"><span class="token punctuation">`</span>actual_assignee_list<span class="token punctuation">`</span></span> <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">500</span><span class="token punctuation">)</span> <span class="token keyword">DEFAULT</span> <span class="token boolean">NULL</span> <span class="token keyword">COMMENT</span> <span class="token string">&#39;流程办理人&#39;</span><span class="token punctuation">,</span>
  <span class="token identifier"><span class="token punctuation">`</span>current_assignee<span class="token punctuation">`</span></span> <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">50</span><span class="token punctuation">)</span> <span class="token keyword">DEFAULT</span> <span class="token boolean">NULL</span> <span class="token keyword">COMMENT</span> <span class="token string">&#39;当前办理人&#39;</span><span class="token punctuation">,</span>
  <span class="token identifier"><span class="token punctuation">`</span>current_task<span class="token punctuation">`</span></span> <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span> <span class="token keyword">DEFAULT</span> <span class="token boolean">NULL</span> <span class="token keyword">COMMENT</span> <span class="token string">&#39;当前办理节点名称&#39;</span><span class="token punctuation">,</span>
  <span class="token identifier"><span class="token punctuation">`</span>accept_task_time<span class="token punctuation">`</span></span> <span class="token keyword">datetime</span> <span class="token keyword">DEFAULT</span> <span class="token boolean">NULL</span> <span class="token keyword">COMMENT</span> <span class="token string">&#39;当前任务接受时间&#39;</span><span class="token punctuation">,</span>
  <span class="token identifier"><span class="token punctuation">`</span>call_back_url<span class="token punctuation">`</span></span> <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">128</span><span class="token punctuation">)</span> <span class="token keyword">DEFAULT</span> <span class="token boolean">NULL</span> <span class="token keyword">COMMENT</span> <span class="token string">&#39;回调URL&#39;</span><span class="token punctuation">,</span>
  <span class="token identifier"><span class="token punctuation">`</span>is_delete<span class="token punctuation">`</span></span> <span class="token keyword">tinyint</span> <span class="token keyword">DEFAULT</span> <span class="token string">&#39;0&#39;</span> <span class="token keyword">COMMENT</span> <span class="token string">&#39;删除标记0未删除1已删除&#39;</span><span class="token punctuation">,</span>
  <span class="token identifier"><span class="token punctuation">`</span>remarks<span class="token punctuation">`</span></span> <span class="token keyword">text</span> <span class="token keyword">COMMENT</span> <span class="token string">&#39;备注&#39;</span><span class="token punctuation">,</span>
  <span class="token keyword">PRIMARY</span> <span class="token keyword">KEY</span> <span class="token punctuation">(</span><span class="token identifier"><span class="token punctuation">`</span>id<span class="token punctuation">`</span></span><span class="token punctuation">)</span> <span class="token keyword">USING</span> <span class="token keyword">BTREE</span>
<span class="token punctuation">)</span> <span class="token keyword">ENGINE</span><span class="token operator">=</span><span class="token keyword">InnoDB</span> <span class="token keyword">DEFAULT</span> <span class="token keyword">CHARSET</span><span class="token operator">=</span>utf8mb4 <span class="token keyword">COLLATE</span><span class="token operator">=</span>utf8mb4_0900_ai_ci ROW_FORMAT<span class="token operator">=</span>COMPACT<span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>这个表可以很好得触达 activiti 的流程，用以最快速的方式查询相应流程资料以及任务。</p><p>然后，activiti 自带了 mybatis，会和 mybatis-plus 冲突，需要排除：</p><div class="language-xml line-numbers-mode" data-ext="xml"><pre class="language-xml"><code>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.activiti<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>activiti-spring-boot-starter<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>7.0.0.SR1<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>exclusions</span><span class="token punctuation">&gt;</span></span>
          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>exclusion</span><span class="token punctuation">&gt;</span></span>
              <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>mybatis<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
              <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.mybatis<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>exclusion</span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>exclusions</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>com.baomidou<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>mybatis-plus-boot-starter<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>3.5.1<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>修改权限配置，对应角色，后续会用到这些角色：</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token punctuation">]</span> usersGroupsAndRoles <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token punctuation">{</span><span class="token string">&quot;jack&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;password&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;user&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;GROUP_activitiTeam&quot;</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span><span class="token string">&quot;rose&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;password&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;user&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;GROUP_activitiTeam&quot;</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span><span class="token string">&quot;tom&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;password&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;groupManager&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;GROUP_activitiTeam&quot;</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span><span class="token string">&quot;bob&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;password&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;projectManager&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;GROUP_otherTeam&quot;</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span><span class="token string">&quot;system&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;password&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;companyManager&quot;</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span><span class="token string">&quot;admin&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;password&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;admin&quot;</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><br><h3 id="员工请假审批" tabindex="-1"><a class="header-anchor" href="#员工请假审批" aria-hidden="true">#</a> <span id="员工请假审批">员工请假审批</span></h3><h4 id="流程模型" tabindex="-1"><a class="header-anchor" href="#流程模型" aria-hidden="true">#</a> 流程模型</h4><p>这里已经算是开发内容了，实际系统的开发也差不多就这样。</p><p><strong>这里提到的都是关键步骤，不重要的自己看源码。</strong></p><p><strong>这里提到的都是关键步骤，不重要的自己看源码。</strong></p><p><strong>这里提到的都是关键步骤，不重要的自己看源码。</strong></p><p>说三遍了，下面全干货</p><p>先在上面提到的模块中画一个流程图</p><blockquote><p><strong>ID 为 AskLeaf</strong> ，<strong>整个ID作为后面开发中需要预设到系统里的</strong>。</p></blockquote><p><img src="https://shiva.oss-cn-hangzhou.aliyuncs.com/picture-master/images/image-20220316232635323.png" alt=""></p><blockquote><p><strong>处理人使用通配符，这里写的 参数名 必须要在系统中 map 中传入值，不然报错</strong></p><p><strong>这里，我的开发习惯是，填写角色名称</strong></p></blockquote><ul><li>applyUser 表示流程发起人</li><li>groupManager 表示流程审批人</li></ul><p><code>其实这里也有过一个关于业务细节的思考，为什么创建流程的人，还需要占一个审批节点？</code></p><p><strong>把创建人作为一个审批节点，可以让创建人有一个撤回的机会。</strong></p><p>比如：张三创建了请假流程，然后日期填错了，但是他自己没有审批，相当于还没有发给领导。</p><img src="https://shiva.oss-cn-hangzhou.aliyuncs.com/picture-master/images/image-20220316153639684.png" alt="image-20220316153639684" style="zoom:80%;"><p>审批人换了一个角色。</p><img src="https://shiva.oss-cn-hangzhou.aliyuncs.com/picture-master/images/image-20220316153657933 - 副本.png" alt="image-202203161536" style="zoom:80%;"><p>好了，部署流程上面已经提过了。</p><p>现在开始代码部分：</p><img src="https://shiva.oss-cn-hangzhou.aliyuncs.com/picture-master/images/1de6bed950f35aed0cd955432c10c282.jpg" alt="1de6bed950f35aed0cd955432c10c282" style="zoom:50%;"><h4 id="代码实现流程创建" tabindex="-1"><a class="header-anchor" href="#代码实现流程创建" aria-hidden="true">#</a> 代码实现流程创建</h4><p>因为模拟 spring security 所以做了个登录步骤，请求类只包括：登录人、理由和时间：</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@Data</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">EmployeeBO</span> <span class="token keyword">implements</span> <span class="token class-name">Serializable</span> <span class="token punctuation">{</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> loginAs<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> reason<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> leafTime<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>接收数据第一步先登录，然后开始业务处理：</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">&quot;/employee/askLeaf&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token class-name">Response</span> <span class="token function">empAskLeaf</span><span class="token punctuation">(</span><span class="token class-name">EmployeeBO</span> employeeBO<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
    <span class="token comment">//先登录，然后就有了当前用户</span>
    securityUtil<span class="token punctuation">.</span><span class="token function">logInAs</span><span class="token punctuation">(</span>employeeBO<span class="token punctuation">.</span><span class="token function">getLoginAs</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//然后申请请假</span>
    employeeService<span class="token punctuation">.</span><span class="token function">askLeaf</span><span class="token punctuation">(</span>employeeBO<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token class-name">Response</span><span class="token punctuation">.</span><span class="token function">builder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">code</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">builsd</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>核心的流程创建方法逻辑如下：</p><p><img src="https://shiva.oss-cn-hangzhou.aliyuncs.com/picture-master/images/image-20220317094707457.png" alt=""></p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token doc-comment comment">/**
  * 员工请假流程
  */</span>
<span class="token annotation punctuation">@Transactional</span><span class="token punctuation">(</span>readOnly <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">,</span> rollbackFor <span class="token operator">=</span> <span class="token class-name">Exception</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">askLeaf</span><span class="token punctuation">(</span><span class="token class-name">EmployeeBO</span> employeeBO<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
    <span class="token comment">//弄个请假的对象</span>
    <span class="token class-name">AskLeaf</span> askLeaf <span class="token operator">=</span> <span class="token function">instanceFromEmployeeBO</span><span class="token punctuation">(</span>employeeBO<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//保存流程信息</span>
    <span class="token class-name">ActProcess</span> actProcess <span class="token operator">=</span> <span class="token function">instanceFromEmployeeBO</span><span class="token punctuation">(</span>askLeaf<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">//发起一个审批流</span>
    <span class="token comment">//启动流程，灵活定义的一些参数：审批人、businessKey、processType 等</span>
    <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span> variables <span class="token operator">=</span> workflowService<span class="token punctuation">.</span><span class="token function">setStartProcess</span><span class="token punctuation">(</span>actProcess<span class="token punctuation">,</span> <span class="token class-name">WorkflowTypeEnum</span><span class="token punctuation">.</span><span class="token constant">ASK_LEAF</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//根据给定的参数，流程实例创建</span>
    <span class="token class-name">ProcessInstance</span> processInstance <span class="token operator">=</span> runtimeService<span class="token punctuation">.</span><span class="token function">startProcessInstanceByKey</span><span class="token punctuation">(</span>
        <span class="token comment">//这里其实是工作流的ID</span>
        <span class="token class-name">WorkflowTypeEnum</span><span class="token punctuation">.</span><span class="token constant">ASK_LEAF</span><span class="token punctuation">.</span>key<span class="token punctuation">,</span>
        <span class="token comment">//然后保存业务key，对应业务表</span>
        actProcess<span class="token punctuation">.</span><span class="token function">getBusinessKey</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        variables<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">//根据流程实例，拿到对应的任务列表；</span>
    <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Task</span><span class="token punctuation">&gt;</span></span> taskList <span class="token operator">=</span> taskService<span class="token punctuation">.</span><span class="token function">createTaskQuery</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">processInstanceId</span><span class="token punctuation">(</span>processInstance<span class="token punctuation">.</span><span class="token function">getProcessInstanceId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">list</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token class-name">CollectionUtils</span><span class="token punctuation">.</span><span class="token function">isEmpty</span><span class="token punctuation">(</span>taskList<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Exception</span><span class="token punctuation">(</span><span class="token string">&quot;请检查流程负责人是否配置齐全！&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">//拿到第一个要执行的任务</span>
    <span class="token class-name">Task</span> task <span class="token operator">=</span> taskList<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">//继续补全流程的其余字段</span>
    <span class="token comment">//流程ID</span>
    actProcess<span class="token punctuation">.</span><span class="token function">setInstanceId</span><span class="token punctuation">(</span>processInstance<span class="token punctuation">.</span><span class="token function">getProcessInstanceId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//当前任务</span>
    actProcess<span class="token punctuation">.</span><span class="token function">setCurrentTask</span><span class="token punctuation">(</span>task<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//下一个要审批的人名字</span>
    actProcess<span class="token punctuation">.</span><span class="token function">setCurrentAssignee</span><span class="token punctuation">(</span>task<span class="token punctuation">.</span><span class="token function">getAssignee</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//任务时间</span>
    actProcess<span class="token punctuation">.</span><span class="token function">setAcceptTaskTime</span><span class="token punctuation">(</span>task<span class="token punctuation">.</span><span class="token function">getCreateTime</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//最后再保存</span>
    processMapper<span class="token punctuation">.</span><span class="token function">insert</span><span class="token punctuation">(</span>actProcess<span class="token punctuation">)</span><span class="token punctuation">;</span>
    log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">&quot;流程：{}，创建成功。业务编号：{}&quot;</span><span class="token punctuation">,</span> <span class="token class-name">WorkflowTypeEnum</span><span class="token punctuation">.</span><span class="token constant">ASK_LEAF</span><span class="token punctuation">.</span>name<span class="token punctuation">,</span> processInstance<span class="token punctuation">.</span><span class="token function">getBusinessKey</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>其他的跳过不说了，这里比较绕的，应该就是获取 <strong>流程参数</strong> 这个方法：</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token doc-comment comment">/**
  * 启动一个流程时，有些参数需要动态返回
  */</span>
<span class="token keyword">public</span> <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span> <span class="token function">setStartProcess</span><span class="token punctuation">(</span><span class="token class-name">ActProcess</span> process<span class="token punctuation">,</span> <span class="token class-name">WorkflowTypeEnum</span> workflowTypeEnum<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span> variables <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HashMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//申请人</span>
    variables<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token class-name">WorkflowConstants</span><span class="token punctuation">.</span><span class="token constant">VARIABLE_APPLY_USER</span><span class="token punctuation">,</span> process<span class="token punctuation">.</span><span class="token function">getApplyUser</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//申请理由</span>
    variables<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token class-name">WorkflowConstants</span><span class="token punctuation">.</span><span class="token constant">VARIABLE_APPLY_REASON</span><span class="token punctuation">,</span> process<span class="token punctuation">.</span><span class="token function">getApplyReason</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//申请类型</span>
    variables<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token class-name">WorkflowConstants</span><span class="token punctuation">.</span><span class="token constant">VARIABLE_PROCESS_TYPE</span><span class="token punctuation">,</span> process<span class="token punctuation">.</span><span class="token function">getProcessType</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//同意</span>
    variables<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token class-name">WorkflowConstants</span><span class="token punctuation">.</span><span class="token constant">VARIABLE_IS_AGREE</span><span class="token punctuation">,</span> <span class="token class-name">WorkflowConstants</span><span class="token punctuation">.</span><span class="token constant">AGREE</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//业务key</span>
    variables<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token class-name">WorkflowConstants</span><span class="token punctuation">.</span><span class="token constant">VARIABLE_BUSINESS_KEY</span><span class="token punctuation">,</span> process<span class="token punctuation">.</span><span class="token function">getBusinessKey</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//关联业务单号</span>
    variables<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token class-name">WorkflowConstants</span><span class="token punctuation">.</span><span class="token constant">VARIABLE_BILL_NO</span><span class="token punctuation">,</span> process<span class="token punctuation">.</span><span class="token function">getRelationBusNo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//添加回调方法</span>
    variables<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token class-name">WorkflowConstants</span><span class="token punctuation">.</span><span class="token constant">VARIABLE_CALLBACK_URL</span><span class="token punctuation">,</span> process<span class="token punctuation">.</span><span class="token function">getCallBackUrl</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">//拿到对应流程的审批路线，审批角色列表</span>
    <span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> roleCodes <span class="token operator">=</span> workflowTypeEnum<span class="token punctuation">.</span>roles<span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">&quot;,&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">String</span> roleCode <span class="token operator">:</span> roleCodes<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token class-name">StringUtils</span><span class="token punctuation">.</span><span class="token function">isEmpty</span><span class="token punctuation">(</span>roleCode<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">continue</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token comment">// TODO 这里肯定要根据实际业务系统修改，目前的用户都是写死的</span>
        <span class="token comment">// 正常的业务系统中，同一个角色会存在多个人，会有多人同时存在审批权限</span>
        <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> assigneeNames <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token punctuation">]</span> usersGroupsAndRoles <span class="token operator">=</span> <span class="token class-name">PermissionsConfiguration</span><span class="token punctuation">.</span><span class="token constant">USERS_GROUPS_AND_ROLES</span><span class="token punctuation">;</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> usersGroupsAndRole <span class="token operator">:</span> usersGroupsAndRoles<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>roleCode<span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>usersGroupsAndRole<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token comment">//查询到了，拥有指定角色的人员</span>
                assigneeNames<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>usersGroupsAndRole<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
        variables<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token class-name">WorkflowConstants</span><span class="token punctuation">.</span><span class="token constant">ROLE_TABLE</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>roleCode<span class="token punctuation">)</span><span class="token punctuation">,</span> assigneeNames<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// 最后返回全部的流程启动参数</span>
    <span class="token keyword">return</span> variables<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>在绘制流程图时，我们用了通配符来定义审批角色：<code>applyUser 表示流程发起人</code>、<code>groupManager 表示流程审批人</code></p><p>这些都需要通过 <strong>variables</strong> 这个传入到 流程实例 中</p><p>这里的大致逻辑为：</p><p><img src="https://shiva.oss-cn-hangzhou.aliyuncs.com/picture-master/images/image-20220317100536964.png" alt=""></p><p>预设枚举类如下：</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">enum</span> <span class="token class-name">WorkflowTypeEnum</span> <span class="token punctuation">{</span>

    <span class="token function">ASK_LEAF</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token string">&quot;请假&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;AskLeaf&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;groupManager&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token function">RESIGN</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">,</span> <span class="token string">&quot;离职&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;Resign&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;companyManager&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token keyword">final</span> <span class="token class-name">Integer</span> value<span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token keyword">final</span> <span class="token class-name">String</span> name<span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token keyword">final</span> <span class="token class-name">String</span> key<span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token keyword">final</span> <span class="token class-name">String</span> roles<span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token keyword">final</span> <span class="token class-name">String</span> callbackUrl<span class="token punctuation">;</span>

    <span class="token comment">//省略构造方法等</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><blockquote><p>**这里的每一个参数都很重要，根据 value 判断流程类别、根据 key 获得流程模型 **</p><p>**尤其要注意 roles，这是一个 <code>,</code> 拼接的字符串，也是对应审批流的通配符（不包括申请人） **</p></blockquote><p>最后完成执行，打印日志：</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>2022-03-16 14:45:56.068  INFO 520 --- [p-nio-80-exec-2] c.s.a.service.EmployeeService            : 流程：请假，创建成功。业务编号：905a92518b5641f89a7f2327555adf37
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><hr><h4 id="流程任务查询" tabindex="-1"><a class="header-anchor" href="#流程任务查询" aria-hidden="true">#</a> 流程任务查询</h4><p>然后查看自己的流程就比较简单了，跳过；</p><p>这里预设了几种常用的任务情况：</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">enum</span> <span class="token class-name">TaskTypeEnum</span> <span class="token punctuation">{</span>

    <span class="token function">TODO_TASK</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token string">&quot;我要处理-待办任务&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token function">COMPLETE_TASK</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token string">&quot;我要处理-已办任务&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token function">MY_UNFINISH_TASK</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token string">&quot;我发起-未处理任务&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token function">MY_FINISH_TASK</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token string">&quot;我发起-已处理任务&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token function">ALL_TASK</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">,</span><span class="token string">&quot;所有任务&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token class-name">Integer</span>  index<span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token class-name">String</span> text<span class="token punctuation">;</span>

<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><img src="https://shiva.oss-cn-hangzhou.aliyuncs.com/picture-master/images/image-20220316164651287.png" alt=""></p><h4 id="确认提交请假申请" tabindex="-1"><a class="header-anchor" href="#确认提交请假申请" aria-hidden="true">#</a> 确认提交请假申请</h4><p>刚刚已经提过了，创建请假申请，已经完成了流程的创建。</p><ul><li><p><strong>第一个节点依然是申请人提交，表示：创建流程的员工，还需要点击确认</strong></p></li><li><p>那么对工作流来说，其实，<strong>申请提交这个动作，也是完成任务</strong></p></li></ul><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">&quot;/process/submitProcess&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token class-name">Response</span> <span class="token function">submitProcess</span><span class="token punctuation">(</span><span class="token class-name">String</span> loginAs<span class="token punctuation">,</span> <span class="token class-name">String</span> processId<span class="token punctuation">,</span> <span class="token class-name">String</span> isAgree<span class="token punctuation">,</span> <span class="token class-name">String</span> comment<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
    securityUtil<span class="token punctuation">.</span><span class="token function">logInAs</span><span class="token punctuation">(</span>loginAs<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//这里其实是，拿到 业务流程id</span>
    <span class="token comment">//再组装完成任务需要的字段内容</span>
    <span class="token class-name">ActProcess</span> process <span class="token operator">=</span> workflowService<span class="token punctuation">.</span><span class="token function">getById</span><span class="token punctuation">(</span>processId<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">CompleteTaskDTO</span> completeTaskDTO <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">CompleteTaskDTO</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    completeTaskDTO<span class="token punctuation">.</span><span class="token function">setBusinessKey</span><span class="token punctuation">(</span>process<span class="token punctuation">.</span><span class="token function">getBusinessKey</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    completeTaskDTO<span class="token punctuation">.</span><span class="token function">setProcessType</span><span class="token punctuation">(</span>process<span class="token punctuation">.</span><span class="token function">getProcessType</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    completeTaskDTO<span class="token punctuation">.</span><span class="token function">setIsAgree</span><span class="token punctuation">(</span><span class="token class-name">Integer</span><span class="token punctuation">.</span><span class="token function">valueOf</span><span class="token punctuation">(</span>isAgree<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    completeTaskDTO<span class="token punctuation">.</span><span class="token function">setComment</span><span class="token punctuation">(</span>comment<span class="token punctuation">)</span><span class="token punctuation">;</span>
    completeTaskDTO<span class="token punctuation">.</span><span class="token function">setAssignee</span><span class="token punctuation">(</span>loginAs<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//调用另一个方法，因为要用到递归，所以单独提取出来</span>
    <span class="token keyword">boolean</span> result <span class="token operator">=</span> <span class="token function">completeTask</span><span class="token punctuation">(</span>completeTaskDTO<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 返回值</span>
    <span class="token keyword">return</span> <span class="token class-name">Response</span><span class="token punctuation">.</span><span class="token function">builder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">code</span><span class="token punctuation">(</span>result <span class="token operator">?</span> <span class="token number">0</span> <span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><blockquote><p>审批入口，其实需要手动做的就是是否同意，然后填个意见。</p></blockquote><p>核心方法是完成审批 completeTask ，它的主要流程为：</p><p><img src="https://shiva.oss-cn-hangzhou.aliyuncs.com/picture-master/images/image-20220317115521200.png" alt=""></p><p>完成任务的递归方法代码：</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code> <span class="token keyword">private</span> <span class="token keyword">boolean</span> <span class="token function">completeTask</span><span class="token punctuation">(</span><span class="token class-name">CompleteTaskDTO</span> completeTaskDTO<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
     <span class="token comment">//然后完成任务，业务actprocess 对应的当前任务默认封装在 service里</span>
     <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Task</span><span class="token punctuation">&gt;</span></span> nextTasks <span class="token operator">=</span> workflowService<span class="token punctuation">.</span><span class="token function">competeTask</span><span class="token punctuation">(</span>completeTaskDTO<span class="token punctuation">)</span><span class="token punctuation">;</span>
     <span class="token comment">// 还存在后续任务，那就需要更新当前 actProcess 的字段，而不是全部结束</span>
     <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token class-name">CollectionUtils</span><span class="token punctuation">.</span><span class="token function">isEmpty</span><span class="token punctuation">(</span>nextTasks<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
         workflowService<span class="token punctuation">.</span><span class="token function">updateProcess</span><span class="token punctuation">(</span>nextTasks<span class="token punctuation">,</span> completeTaskDTO<span class="token punctuation">)</span><span class="token punctuation">;</span>
     <span class="token punctuation">}</span>
     <span class="token comment">// 下一个节点处理人和当前节点处理人属于同一个 自动处理</span>
     <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token class-name">CollectionUtils</span><span class="token punctuation">.</span><span class="token function">isEmpty</span><span class="token punctuation">(</span>nextTasks<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
         <span class="token class-name">String</span> confirmAssignee <span class="token operator">=</span> completeTaskDTO<span class="token punctuation">.</span><span class="token function">getAssignee</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
         <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Task</span><span class="token punctuation">&gt;</span></span> nextTodoList <span class="token operator">=</span> nextTasks<span class="token punctuation">.</span><span class="token function">stream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span>nextTask <span class="token operator">-&gt;</span> nextTask<span class="token punctuation">.</span><span class="token function">getAssignee</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">contains</span><span class="token punctuation">(</span>confirmAssignee<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">limit</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">collect</span><span class="token punctuation">(</span><span class="token class-name">Collectors</span><span class="token punctuation">.</span><span class="token function">toList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
         <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token class-name">CollectionUtils</span><span class="token punctuation">.</span><span class="token function">isEmpty</span><span class="token punctuation">(</span>nextTodoList<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
             log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">&quot;【审核跳过】：{}&quot;</span><span class="token punctuation">,</span> nextTodoList<span class="token punctuation">)</span><span class="token punctuation">;</span>
             completeTaskDTO<span class="token punctuation">.</span><span class="token function">setComment</span><span class="token punctuation">(</span><span class="token string">&quot;审批连续节点-自动同意&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
             <span class="token function">completeTask</span><span class="token punctuation">(</span>completeTaskDTO<span class="token punctuation">)</span><span class="token punctuation">;</span>
         <span class="token punctuation">}</span>
     <span class="token punctuation">}</span>
     <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
 <span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code> <span class="token annotation punctuation">@Transactional</span><span class="token punctuation">(</span>readOnly <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">,</span> rollbackFor <span class="token operator">=</span> <span class="token class-name">Exception</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Task</span><span class="token punctuation">&gt;</span></span> <span class="token function">competeTask</span><span class="token punctuation">(</span><span class="token class-name">CompleteTaskDTO</span> completeTaskDTO<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
    <span class="token comment">// 审核意见 同意/不同意</span>
    <span class="token class-name">Integer</span> isAgree <span class="token operator">=</span> completeTaskDTO<span class="token punctuation">.</span><span class="token function">getIsAgree</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 审批意见</span>
    <span class="token class-name">String</span> comment <span class="token operator">=</span> completeTaskDTO<span class="token punctuation">.</span><span class="token function">getComment</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 审批人</span>
    <span class="token class-name">String</span> confirmAssignee <span class="token operator">=</span> completeTaskDTO<span class="token punctuation">.</span><span class="token function">getAssignee</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 审批参数</span>
    <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span> variables <span class="token operator">=</span> completeTaskDTO<span class="token punctuation">.</span><span class="token function">getVariables</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token keyword">null</span> <span class="token operator">?</span> <span class="token keyword">new</span> <span class="token class-name">HashMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">:</span> completeTaskDTO<span class="token punctuation">.</span><span class="token function">getVariables</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">//添加是否同意到审批参数</span>
    variables<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token class-name">WorkflowConstants</span><span class="token punctuation">.</span><span class="token constant">VARIABLE_IS_AGREE</span><span class="token punctuation">,</span> isAgree<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 查询待办任务</span>
    <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Task</span><span class="token punctuation">&gt;</span></span> tasks <span class="token operator">=</span> <span class="token function">getTaskByBusinessKey</span><span class="token punctuation">(</span>completeTaskDTO<span class="token punctuation">.</span><span class="token function">getBusinessKey</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> completeTaskDTO<span class="token punctuation">.</span><span class="token function">getProcessType</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 从任务列表中，获得审批人包含 confirmAssignee 的任务</span>
    <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Task</span><span class="token punctuation">&gt;</span></span> currentTasks <span class="token operator">=</span> tasks<span class="token punctuation">.</span><span class="token function">stream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span>task <span class="token operator">-&gt;</span> task<span class="token punctuation">.</span><span class="token function">getAssignee</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">contains</span><span class="token punctuation">(</span>confirmAssignee<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">collect</span><span class="token punctuation">(</span><span class="token class-name">Collectors</span><span class="token punctuation">.</span><span class="token function">toList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token class-name">CollectionUtils</span><span class="token punctuation">.</span><span class="token function">isEmpty</span><span class="token punctuation">(</span>currentTasks<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Exception</span><span class="token punctuation">(</span><span class="token string">&quot;当前操作人(&quot;</span> <span class="token operator">+</span> confirmAssignee <span class="token operator">+</span> <span class="token string">&quot;)不具备该节点审核资格！&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// 查询当前办理人（当前任务的办理人）</span>
    <span class="token class-name">Task</span> task <span class="token operator">=</span> currentTasks<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span> existVariables <span class="token operator">=</span> task<span class="token punctuation">.</span><span class="token function">getProcessVariables</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">//节点完成</span>
    <span class="token function">completeTask</span><span class="token punctuation">(</span>task<span class="token punctuation">,</span> comment<span class="token punctuation">,</span> variables<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 拿到后续的任务</span>
    <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Task</span><span class="token punctuation">&gt;</span></span> nextTasks <span class="token operator">=</span> taskService<span class="token punctuation">.</span><span class="token function">createTaskQuery</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">processInstanceId</span><span class="token punctuation">(</span>task<span class="token punctuation">.</span><span class="token function">getProcessInstanceId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">list</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//如果不存在下一个任务，那就可以调用结束回调方法</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token class-name">CollectionUtils</span><span class="token punctuation">.</span><span class="token function">isEmpty</span><span class="token punctuation">(</span>nextTasks<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// 调用业务回调</span>
        <span class="token class-name">String</span> callbackUrl <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">)</span> existVariables<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token class-name">WorkflowConstants</span><span class="token punctuation">.</span><span class="token constant">VARIABLE_CALLBACK_URL</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">String</span> businessKey <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">)</span> existVariables<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token class-name">WorkflowConstants</span><span class="token punctuation">.</span><span class="token constant">VARIABLE_BUSINESS_KEY</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token class-name">StringUtils</span><span class="token punctuation">.</span><span class="token function">isNotEmpty</span><span class="token punctuation">(</span>callbackUrl<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token class-name">StringUtils</span><span class="token punctuation">.</span><span class="token function">isNotEmpty</span><span class="token punctuation">(</span>businessKey<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment">//TODO 这里可以进行业务回调，回调 URL 可以是消息、方法、和接口</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// 如果本次审核被拒绝，或者流程已经结束，相当于流程已经结束</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>isAgree <span class="token operator">==</span> <span class="token number">0</span> <span class="token operator">||</span> <span class="token class-name">CollectionUtils</span><span class="token punctuation">.</span><span class="token function">isEmpty</span><span class="token punctuation">(</span>nextTasks<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// 更新流程记录</span>
        <span class="token function">completeWorkProcess</span><span class="token punctuation">(</span>completeTaskDTO<span class="token punctuation">,</span> task<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> nextTasks<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>其中：<code>updateProcess</code>、<code>completeTask</code> 这几个方法就省略了，全是 <code>get、set</code></p><blockquote><p>这里涉及到了完成流程、业务回调的功能。先不涉及，在后面介绍。</p></blockquote><br><h3 id="员工离职审批" tabindex="-1"><a class="header-anchor" href="#员工离职审批" aria-hidden="true">#</a> <span id="员工离职审批">员工离职审批</span></h3><p>这个案例中，实现两个功能：<strong>拒绝流程、完成回调。</strong></p><p>有没有发现，在上面的流程中，只是一条线，所以，无论你是同意还是拒绝，都会按顺序往下运行。</p><p>现在上新流程：</p><p><img src="https://shiva.oss-cn-hangzhou.aliyuncs.com/picture-master/images/image-20220317231423987.png" alt=""></p><p>与原流程相比，多了几条路线，并为路线设置了跳转条件。</p><p>这个也很明显，不过多解释。</p><blockquote><p><strong>如果任意一个审批步骤拒绝，就会结束流程</strong></p></blockquote><p>关键代码如下：</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@Transactional</span><span class="token punctuation">(</span>readOnly <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">,</span> rollbackFor <span class="token operator">=</span> <span class="token class-name">Exception</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Task</span><span class="token punctuation">&gt;</span></span> <span class="token function">competeTask</span><span class="token punctuation">(</span><span class="token class-name">CompleteTaskDTO</span> completeTaskDTO<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
     <span class="token comment">//添加是否同意到审批参数</span>
    variables<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token class-name">WorkflowConstants</span><span class="token punctuation">.</span><span class="token constant">VARIABLE_IS_AGREE</span><span class="token punctuation">,</span> isAgree<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
    <span class="token comment">//节点完成</span>
    <span class="token function">completeTask</span><span class="token punctuation">(</span>task<span class="token punctuation">,</span> comment<span class="token punctuation">,</span> variables<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
    <span class="token comment">// 如果本次审核被拒绝，或者流程已经结束，相当于流程已经结束</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>isAgree <span class="token operator">==</span> <span class="token number">0</span> <span class="token operator">||</span> <span class="token class-name">CollectionUtils</span><span class="token punctuation">.</span><span class="token function">isEmpty</span><span class="token punctuation">(</span>nextTasks<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// 更新流程记录</span>
        <span class="token function">completeWorkProcess</span><span class="token punctuation">(</span>completeTaskDTO<span class="token punctuation">,</span> task<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>将是否同意审批的参数传入。</p><p><strong>如果本次的审批为拒绝，那么就直接结束流程，重置 业务process的参数</strong></p><p>在全部流程结束后，还可以触发回调：</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token comment">//如果不存在下一个任务，那就可以调用结束回调方法</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token class-name">CollectionUtils</span><span class="token punctuation">.</span><span class="token function">isEmpty</span><span class="token punctuation">(</span>nextTasks<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 调用业务回调</span>
    <span class="token class-name">String</span> callbackUrl <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">)</span> existVariables<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token class-name">WorkflowConstants</span><span class="token punctuation">.</span><span class="token constant">VARIABLE_CALLBACK_URL</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">String</span> businessKey <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">)</span> existVariables<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token class-name">WorkflowConstants</span><span class="token punctuation">.</span><span class="token constant">VARIABLE_BUSINESS_KEY</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token class-name">StringUtils</span><span class="token punctuation">.</span><span class="token function">isNotEmpty</span><span class="token punctuation">(</span>callbackUrl<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token class-name">StringUtils</span><span class="token punctuation">.</span><span class="token function">isNotEmpty</span><span class="token punctuation">(</span>businessKey<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">//TODO 这里可以进行业务回调，回调 URL 可以是消息、方法、和接口</span>
        workflowCallBackService<span class="token punctuation">.</span><span class="token function">doCallBack</span><span class="token punctuation">(</span>callbackUrl<span class="token punctuation">,</span> businessKey<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code> [p-nio-80-exec-4] c.s.a.service.WorkflowCallBackService    : 工作流结束，回调触发：com.xxx.xx.x.ss()，回调参数：2df5731025d7410d810631e5b2173889
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><br><h3 id="费用报销多人会签" tabindex="-1"><a class="header-anchor" href="#费用报销多人会签" aria-hidden="true">#</a> <span id="费用报销多人会签">费用报销多人会签</span></h3><p>比如有这么一种情况，报销20块钱，需要 3个财务一起审批。</p><p>这种多人会签的情况，在实际业务中也很常见。。。</p><p>流程就不重新画了，就用那个离职审批，先加一个公司管理员的用户：</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token punctuation">{</span><span class="token string">&quot;manager&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;password&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;companyManager&quot;</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>那么现在就有两个公司管理员：<code>manager</code>、<code>system</code></p><p>修改流程如下：</p><p><img src="https://shiva.oss-cn-hangzhou.aliyuncs.com/picture-master/images/image-20220318115100069.png" alt=""></p><p>这里面的几个核心要点：</p><blockquote><ol><li><strong>多实例类型要选择：parallel 平行、 sequential 顺序</strong></li><li><strong>多实例集合要命名，这个一般在 Assignee 后加个 List</strong> ，例如 projectManager 对应 projectManagerList</li><li><strong>多实例变量要填上，和 Assignee 一样就行</strong></li><li><strong>完成添加需要补充，这里是只要有一个任务被拒绝，直接结束</strong></li></ol></blockquote><p>然后在根据角色编号获取 流程定义参数时，需要传入 多实例List 类型：</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code>
<span class="token keyword">public</span> <span class="token keyword">final</span> <span class="token keyword">class</span> <span class="token class-name">WorkflowConstants</span> <span class="token punctuation">{</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> <span class="token constant">ROLE_TABLE</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HashMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">/*
    |角色 |角色英文名|角色编号|
    |总经理 |generalManager|088|
    */</span>
    <span class="token keyword">static</span> <span class="token punctuation">{</span>
        <span class="token constant">ROLE_TABLE</span><span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;groupManager&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;groupManagerList&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token constant">ROLE_TABLE</span><span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;projectManager&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;projectManagerList&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token constant">ROLE_TABLE</span><span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;companyManager&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;companyManagerList&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token constant">ROLE_TABLE</span><span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;admin&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;adminList&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>其他不变，看测试结果，可以看到已经有一个 manager 审批，但是流程并没有结束。</p><p><img src="https://shiva.oss-cn-hangzhou.aliyuncs.com/picture-master/images/image-20220318124625539.png" alt="image-20220318124625539"></p><br><h3 id="公司缺人离职不批" tabindex="-1"><a class="header-anchor" href="#公司缺人离职不批" aria-hidden="true">#</a> <span id="公司缺人离职不批">公司缺人离职不批</span></h3><p>比如现在，公司业务紧张，天天加班，你还想跑路？做梦都别想。</p><p><strong>所以这时候防止大家提交离职审批，可以把离职流程暂时挂起，不允许申请。</strong></p><p>这只是一个简单API，代码一放跳过：</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code>    <span class="token doc-comment comment">/**
     * 挂起流程
     * <span class="token keyword">@param</span> <span class="token parameter">status</span> 0-挂起，1-恢复
     */</span>
    <span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">&quot;/process/processSuspend&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">Response</span> <span class="token function">processSuspend</span><span class="token punctuation">(</span><span class="token class-name">String</span> processKey<span class="token punctuation">,</span> <span class="token class-name">String</span> status<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">//拿到指定的流程定义</span>
        <span class="token class-name">ProcessDefinition</span> processDefinition <span class="token operator">=</span> repositoryService<span class="token punctuation">.</span><span class="token function">createProcessDefinitionQuery</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">processDefinitionKey</span><span class="token punctuation">(</span>processKey<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">singleResult</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 得到当前流程定义的实例是否都为暂停状态</span>
        <span class="token keyword">boolean</span> suspended <span class="token operator">=</span> processDefinition<span class="token punctuation">.</span><span class="token function">isSuspended</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//拿到流程定义ID</span>
        <span class="token class-name">String</span> processId <span class="token operator">=</span> processDefinition<span class="token punctuation">.</span><span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token string">&quot;0&quot;</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>status<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment">//恢复，如果是暂停，可以执行激活操作 ,参数1 ：流程定义id ，参数2：是否激活，参数3：激活时间</span>
            repositoryService<span class="token punctuation">.</span><span class="token function">activateProcessDefinitionById</span><span class="token punctuation">(</span>processId<span class="token punctuation">,</span>
                    <span class="token boolean">true</span><span class="token punctuation">,</span>
                    <span class="token keyword">null</span>
            <span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token string">&quot;1&quot;</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>status<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment">//挂起，如果是激活状态，可以暂停，参数1 ：流程定义id ，参数2：是否暂停，参数3：暂停时间</span>
            repositoryService<span class="token punctuation">.</span><span class="token function">suspendProcessDefinitionById</span><span class="token punctuation">(</span>processId<span class="token punctuation">,</span>
                    <span class="token boolean">true</span><span class="token punctuation">,</span>
                    <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> <span class="token class-name">Response</span><span class="token punctuation">.</span><span class="token function">builder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">code</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>测试下，把离职停了，最后请假正常创建，离职报错。</p><p><img src="https://shiva.oss-cn-hangzhou.aliyuncs.com/picture-master/images/image-20220318213042515.png" alt=""></p><p><img src="https://shiva.oss-cn-hangzhou.aliyuncs.com/picture-master/images/image-20220318213029686.png" alt="image-20220318213029686"></p><br><h3 id="流程签署自动提醒" tabindex="-1"><a class="header-anchor" href="#流程签署自动提醒" aria-hidden="true">#</a> <span id="流程签署自动提醒">流程签署自动提醒</span></h3><p>然后再看最后的事件监听，首先看上面会签中。</p><p>只能看到由哪几个角色进行了审批，但是 manager 和 system 是一个环节啊，能不能合在一起呢？</p><p><img src="https://shiva.oss-cn-hangzhou.aliyuncs.com/picture-master/images/image-20220318194038333.png" alt=""></p><p>这里就可以加一个监听了。</p><img src="https://shiva.oss-cn-hangzhou.aliyuncs.com/picture-master/images/image-20220318215948804.png" alt="image-20220318215948804" style="zoom:80%;"><img src="https://shiva.oss-cn-hangzhou.aliyuncs.com/picture-master/images/image-20220318215928549.png" alt="image-20220318215928549" style="zoom:80%;"><p>直接加个监听器，继承 <code>ExecutionListener</code> ：</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@Component</span>
<span class="token annotation punctuation">@Slf4j</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">StartListener</span> <span class="token keyword">implements</span> <span class="token class-name">ExecutionListener</span> <span class="token punctuation">{</span>

    <span class="token doc-comment comment">/**
     * 序列化
     */</span>
    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token keyword">long</span> serialVersionUID <span class="token operator">=</span> <span class="token number">3599293834301636975L</span><span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">notify</span><span class="token punctuation">(</span><span class="token class-name">DelegateExecution</span> execution<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">&quot;监听到启动了一个新实例&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 获取流程变量</span>
        <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span> variables <span class="token operator">=</span> execution<span class="token punctuation">.</span><span class="token function">getVariables</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 开启支持跳过表达式</span>
        variables<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token class-name">WorkflowConstants</span><span class="token punctuation">.</span><span class="token constant">SKIP_EXPRESSION</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 将修改同步到流程中</span>
        <span class="token comment">// execution.setTransientVariables(variables);</span>
        <span class="token comment">// 这种方式也行。直接设置流程变量</span>
        execution<span class="token punctuation">.</span><span class="token function">setVariable</span><span class="token punctuation">(</span><span class="token class-name">WorkflowConstants</span><span class="token punctuation">.</span><span class="token constant">SKIP_EXPRESSION</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><img src="https://shiva.oss-cn-hangzhou.aliyuncs.com/picture-master/images/image-20220318223012166.png" alt=""></p><hr><p>会签监听：</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@Slf4j</span>
<span class="token annotation punctuation">@Component</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">SignListener</span> <span class="token keyword">implements</span> <span class="token class-name">TaskListener</span> <span class="token punctuation">{</span>
    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token keyword">long</span> serialVersionUID <span class="token operator">=</span> <span class="token number">1L</span><span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">notify</span><span class="token punctuation">(</span><span class="token class-name">DelegateTask</span> delegateTask<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">&quot;会签监听&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//获取流程id</span>
        <span class="token class-name">String</span> exId <span class="token operator">=</span> delegateTask<span class="token punctuation">.</span><span class="token function">getExecutionId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Integer</span> isAgree <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">Integer</span><span class="token punctuation">)</span> runtimeService<span class="token punctuation">.</span><span class="token function">getVariable</span><span class="token punctuation">(</span>exId<span class="token punctuation">,</span> <span class="token string">&quot;isAgree&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">&quot;结果：{}&quot;</span><span class="token punctuation">,</span> isAgree<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><img src="https://shiva.oss-cn-hangzhou.aliyuncs.com/picture-master/images/image-20220318220049988.png" alt="image-20220318220049988" style="zoom:80%;"><img src="https://shiva.oss-cn-hangzhou.aliyuncs.com/picture-master/images/image-20220318220030104.png" alt="image-20220318220030104" style="zoom:80%;"><p><img src="https://shiva.oss-cn-hangzhou.aliyuncs.com/picture-master/images/image-20220318223349082.png" alt=""></p><br><h2 id="其他功能" tabindex="-1"><a class="header-anchor" href="#其他功能" aria-hidden="true">#</a> <span id="其他功能">其他功能</span></h2><p>除了上面这些，Activiti 还有很多其他更加复杂的操作功能：</p><ul><li><strong>网关：排他、并行、包含、事件</strong></li><li><strong>触发：短信、邮件等</strong></li></ul><p>因为还没有用到，估计也用不太到，所以就不涉及了。</p><p><strong>That&#39;s All ！</strong></p><br><h2 id="参考文章" tabindex="-1"><a class="header-anchor" href="#参考文章" aria-hidden="true">#</a> <span id="te">参考文章</span></h2><ol><li><a href="https://blog.csdn.net/weixin_46990523/article/details/109473507" target="_blank" rel="noopener noreferrer">Activiti7工作流引擎_Roc的博客-CSDN博客_activiti工作流引擎<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></li><li><a href="https://www.bilibili.com/video/BV1H54y167gf?p=3" target="_blank" rel="noopener noreferrer">黑马程序员java教程最新工作流引擎Activiti7基础到进阶，Activiti和Spring框架、SpringBoot整合_哔哩哔哩_bilibili<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></li><li><a href="https://blog.csdn.net/feiniao168/article/details/83889966" target="_blank" rel="noopener noreferrer">BPMN详细介绍_feiniao168的专栏-CSDN博客<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></li><li><a href="https://blog.csdn.net/qq_34839150/article/details/109903454" target="_blank" rel="noopener noreferrer">SpringBoot整合Activiti7使用_菜菜的博客-CSDN博客_springboot整合activiti7<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></li><li><a href="https://blog.csdn.net/qq_38423256/article/details/116332791" target="_blank" rel="noopener noreferrer">Activiti7工作流引擎之常用API操作_喜羊羊love红太狼-CSDN博客_activiti7的api<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></li></ol></div><!--[--><!--]--></div><footer class="page-meta"><!----><div class="meta-item last-updated"><span class="meta-item-label">Last Updated: </span><!----></div><div class="meta-item contributors"><span class="meta-item-label">Contributors: </span><span class="meta-item-info"><!--[--><!--[--><span class="contributor" title="email: hqw3.14159263">qianwei4712@163.com</span><!----><!--]--><!--]--></span></div></footer><nav class="page-nav"><p class="inner"><span class="prev"><a href="/showns-vuepress/apply/frame/QuartzBaseApply.html" class="" aria-label="Quartz - 任务调度框架整合使用"><!--[--><!--]--> Quartz - 任务调度框架整合使用 <!--[--><!--]--></a></span><!----></p></nav><!--[--><!--]--></main><!--]--></div><!----><!--]--></div>
    <script type="module" src="/showns-vuepress/assets/app-85a03126.js" defer></script>
  </body>
</html>
