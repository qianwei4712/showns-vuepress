import{_ as s,o as n,c as a,f as e}from"./app-7e2007b0.js";const p={},t=e(`<h2 id="jenkins-发布-docker-服务" tabindex="-1"><a class="header-anchor" href="#jenkins-发布-docker-服务" aria-hidden="true">#</a> jenkins 发布 docker 服务</h2><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token comment"># 先定义镜像和版本信息</span>
<span class="token assign-left variable">DOCKERNAME</span><span class="token operator">=</span><span class="token string">&#39;cloudspiderTest&#39;</span>
<span class="token assign-left variable">REPOSITORIES</span><span class="token operator">=</span><span class="token string">&#39;cloudspider/test&#39;</span>
<span class="token assign-left variable">TAG</span><span class="token operator">=</span><span class="token variable"><span class="token variable">\`</span><span class="token function">date</span> +%Y%m%d-%H%M%S<span class="token variable">\`</span></span>

<span class="token comment"># 删除原来的容器</span>
<span class="token assign-left variable">CONTAINER_ID</span><span class="token operator">=</span><span class="token variable"><span class="token variable">\`</span><span class="token function">docker</span> <span class="token function">ps</span> <span class="token operator">|</span> <span class="token function">grep</span> <span class="token string">&quot;<span class="token variable">\${DOCKERNAME}</span>&quot;</span> <span class="token operator">|</span> <span class="token function">awk</span> <span class="token string">&#39;{print $1}&#39;</span><span class="token variable">\`</span></span>
<span class="token keyword">if</span> <span class="token punctuation">[</span> <span class="token parameter variable">-n</span> <span class="token string">&quot;<span class="token variable">$CONTAINER_ID</span>&quot;</span> <span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token keyword">then</span>
    <span class="token function">docker</span> stop <span class="token variable">$CONTAINER_ID</span>
    <span class="token function">docker</span> <span class="token function">rm</span> <span class="token variable">$CONTAINER_ID</span>
<span class="token keyword">else</span> <span class="token comment">#如果容器启动时失败了，就需要docker ps -a才能找到那个容器</span>
    <span class="token assign-left variable">CONTAINER_ID</span><span class="token operator">=</span><span class="token variable"><span class="token variable">\`</span><span class="token function">docker</span> <span class="token function">ps</span> <span class="token parameter variable">-a</span> <span class="token operator">|</span> <span class="token function">grep</span> <span class="token string">&quot;<span class="token variable">\${DOCKERNAME}</span>&quot;</span> <span class="token operator">|</span> <span class="token function">awk</span> <span class="token string">&#39;{print $1}&#39;</span><span class="token variable">\`</span></span>
    <span class="token keyword">if</span> <span class="token punctuation">[</span> <span class="token parameter variable">-n</span> <span class="token string">&quot;<span class="token variable">$CONTAINER_ID</span>&quot;</span> <span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token keyword">then</span>  <span class="token comment"># 如果是第一次在这台机器上拉取运行容器，那么docker ps -a也是找不到这个容器的</span>
        <span class="token function">docker</span> <span class="token function">rm</span> <span class="token variable">$CONTAINER_ID</span>
    <span class="token keyword">fi</span>
<span class="token keyword">fi</span>

<span class="token comment"># 删除原来的镜像</span>
<span class="token assign-left variable">IMAGE_ID</span><span class="token operator">=</span><span class="token variable"><span class="token variable">\`</span><span class="token function">sudo</span> <span class="token function">docker</span> images <span class="token operator">|</span> <span class="token function">grep</span> $<span class="token punctuation">{</span>REPOSITORIES<span class="token punctuation">}</span> <span class="token operator">|</span> <span class="token function">awk</span> <span class="token string">&#39;{print $3}&#39;</span><span class="token variable">\`</span></span>
<span class="token keyword">if</span> <span class="token punctuation">[</span> <span class="token parameter variable">-n</span> <span class="token string">&quot;<span class="token variable">\${IMAGE_ID}</span>&quot;</span> <span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token keyword">then</span>
    <span class="token function">docker</span> rmi <span class="token variable">\${IMAGE_ID}</span>
<span class="token keyword">fi</span>

<span class="token comment"># dockerfile 构建镜像并启动容器</span>
<span class="token function">docker</span> build <span class="token parameter variable">-f</span> dockerfile <span class="token parameter variable">-t</span> <span class="token variable">\${REPOSITORIES}</span><span class="token builtin class-name">:</span><span class="token variable">\${TAG}</span> <span class="token builtin class-name">.</span>
<span class="token function">docker</span> run <span class="token parameter variable">-itd</span> <span class="token parameter variable">--name</span><span class="token operator">=</span><span class="token variable">\${DOCKERNAME}</span> <span class="token parameter variable">-p</span> <span class="token number">8081</span>:80 <span class="token parameter variable">-v</span> /opt/docker-logs/<span class="token variable">\${DOCKERNAME}</span>:/opt/platform/logs <span class="token variable">\${REPOSITORIES}</span><span class="token builtin class-name">:</span><span class="token variable">\${TAG}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="jenkins-停止指定服务进程" tabindex="-1"><a class="header-anchor" href="#jenkins-停止指定服务进程" aria-hidden="true">#</a> jenkins 停止指定服务进程</h2><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token comment"># 先定义需要查找的进程</span>
<span class="token assign-left variable">SERVERNAME</span><span class="token operator">=</span><span class="token string">&#39;servername.jar&#39;</span>
<span class="token comment"># 查找删除</span>
<span class="token assign-left variable">pid</span><span class="token operator">=</span><span class="token variable"><span class="token variable">$(</span><span class="token function">ps</span> <span class="token parameter variable">-ef</span> <span class="token operator">|</span> <span class="token function">grep</span> $<span class="token punctuation">{</span>SERVERNAME<span class="token punctuation">}</span> <span class="token operator">|</span> <span class="token function">grep</span> <span class="token parameter variable">-v</span> <span class="token function">grep</span> <span class="token operator">|</span> <span class="token function">awk</span> <span class="token string">&#39;{print $2}&#39;</span><span class="token variable">)</span></span>
<span class="token keyword">if</span> <span class="token punctuation">[</span> <span class="token parameter variable">-n</span> <span class="token string">&quot;<span class="token variable">$pid</span>&quot;</span> <span class="token punctuation">]</span>
<span class="token keyword">then</span>
   <span class="token function">kill</span> <span class="token parameter variable">-9</span> <span class="token variable">$pid</span>
<span class="token keyword">fi</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>`,4),l=[t];function o(c,i){return n(),a("div",null,l)}const k=s(p,[["render",o],["__file","jenkins 常用 shell 命令.html.vue"]]);export{k as default};
