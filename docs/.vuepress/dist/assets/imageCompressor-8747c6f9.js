import{l as W,k as D,_ as X,r as I,o as A,c as T,a as M,w as k,b as C,t as z,d as L,p as G,i as K}from"./app-c1e62972.js";var V={exports:{}},P={exports:{}};(function(v,x){(function(y,w){v.exports=w()})(window,function(){return function(y){var w={};function i(l){if(w[l])return w[l].exports;var u=w[l]={i:l,l:!1,exports:{}};return y[l].call(u.exports,u,u.exports,i),u.l=!0,u.exports}return i.m=y,i.c=w,i.d=function(l,u,O){i.o(l,u)||Object.defineProperty(l,u,{enumerable:!0,get:O})},i.r=function(l){typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(l,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(l,"__esModule",{value:!0})},i.t=function(l,u){if(1&u&&(l=i(l)),8&u||4&u&&typeof l=="object"&&l&&l.__esModule)return l;var O=Object.create(null);if(i.r(O),Object.defineProperty(O,"default",{enumerable:!0,value:l}),2&u&&typeof l!="string")for(var f in l)i.d(O,f,(function(c){return l[c]}).bind(null,f));return O},i.n=function(l){var u=l&&l.__esModule?function(){return l.default}:function(){return l};return i.d(u,"a",u),u},i.o=function(l,u){return Object.prototype.hasOwnProperty.call(l,u)},i.p="",i(i.s=0)}([function(y,w,i){i.r(w);var l=window,u=/^image\//,O=/\.\w+$/,f={},c={file:null,quality:.8,convertSize:2048e3,loose:!0,redressOrientation:!0},a=function(e){return typeof e=="function"},_=function(e){return u.test(e)};function p(e){e=Object.assign({},c,e),this.options=e,this.file=e.file,this.image=null,this.ParsedOrientationInfo=null,this.init()}var d=p.prototype;for(var S in w.default=p,d.init=function(){var e=this,o=this.file,n=this.options;o&&_(o.type)?(_(n.mimeType)||(n.mimeType=o.type),f.file2Image(o,function(t){a(e.beforeCompress)&&(e.image=t,o.width=t.naturalWidth,o.height=t.naturalHeight,e.beforeCompress(o)),o.type==="image/jpeg"&&n.redressOrientation?e.getParsedOrientationInfo(function(s){e.parsedOrientationInfo=s,e.rendCanvas()}):(e.parsedOrientationInfo={rotate:0,scaleX:1,scaleY:1},e.rendCanvas())},e.error)):e.error("请上传图片文件!")},d.rendCanvas=function(){var e=this,o=this.options,n=this.image,t=this.getExpectedEdge(),s=t.dWidth,h=t.dHeight,b=t.width,r=t.height,m=f.image2Canvas(n,s,h,e.beforeDraw.bind(e),e.afterDraw.bind(e),b,r);f.canvas2Blob(m,function(g){g&&(g.width=m.width,g.height=m.height),e.success(g)},o.quality,o.mimeType)},d.beforeCompress=function(){a(this.options.beforeCompress)&&this.options.beforeCompress(this.file)},d.getExpectedEdge=function(){var e,o=this.image,n=this.parsedOrientationInfo.rotate,t=this.options,s=o.naturalWidth,h=o.naturalHeight,b=Math.abs(n)%180==90;b&&(e=h,h=s,s=e);var r=s/h,m=Math.max(t.maxWidth,0)||1/0,g=Math.max(t.maxHeight,0)||1/0,U=Math.max(t.minWidth,0)||0,j=Math.max(t.minHeight,0)||0,E=Math.max(t.width,0)||s,R=Math.max(t.height,0)||h;m<1/0&&g<1/0?g*r>m?g=m/r:m=g*r:m<1/0?g=m/r:g<1/0&&(m=g*r),U>0&&j>0?j*r>U?j=U/r:U=j*r:U>0?j=U/r:j>0&&(U=j*r),R*r>E?R=E/r:E=R*r;var F=E=Math.floor(Math.min(Math.max(E,U),m)),B=R=Math.floor(Math.min(Math.max(R,j),g));return b&&(e=B,B=F,F=e),{dWidth:F,dHeight:B,width:E,height:R}},d.getParsedOrientationInfo=function(e){var o=this;this.getOrientation(function(n){a(e)&&e(o.parseOrientation(n))})},d.getOrientation=function(e){var o=this;f.file2ArrayBuffer(this.file,function(n){a(e)&&e(o.resetAndGetOrientation(n))})},d.resetAndGetOrientation=function(e){var o,n=new DataView(e);try{var t,s,h;if(n.getUint8(0)===255&&n.getUint8(1)===216)for(var b=n.byteLength,r=2;r+1<b;){if(n.getUint8(r)===255&&n.getUint8(r+1)===225){s=r;break}r+=1}if(s){var m=s+4,g=s+10;if(f.getStringFromCharCode(n,m,4)==="Exif"){var U=n.getUint16(g);if(((t=U===18761)||U===19789)&&n.getUint16(g+2,t)===42){var j=n.getUint32(g+4,t);j>=8&&(h=g+j)}}}if(h){var E;for(b=n.getUint16(h,t),E=0;E<b;E+=1)if(r=h+12*E+2,n.getUint16(r,t)===274){r+=8,o=n.getUint16(r,t),n.setUint16(r,1,t);break}}}catch(R){console.error(R),o=1}return o},d.parseOrientation=function(e){var o=0,n=1,t=1;switch(e){case 2:n=-1;break;case 3:o=-180;break;case 4:t=-1;break;case 5:o=90,t=-1;break;case 6:o=90;break;case 7:o=90,n=-1;break;case 8:o=-90}return{rotate:o,scaleX:n,scaleY:t}},d.beforeDraw=function(e,o){var n=this.parsedOrientationInfo,t=n.rotate,s=n.scaleX,h=n.scaleY,b=this.file,r=this.options,m="transparent",g=o.width,U=o.height;switch(b.size>r.convertSize&&r.mimeType==="image/png"&&(m="#fff",r.mimeType="image/jpeg"),e.fillStyle=m,e.fillRect(0,0,g,U),a(r.beforeDraw)&&r.beforeDraw.call(this,e,o),e.save(),t){case 90:e.translate(g,0);break;case-90:e.translate(0,U);break;case-180:e.translate(g,U)}e.rotate(t*Math.PI/180),e.scale(s,h)},d.afterDraw=function(e,o){var n=this.options;a(n.afterDraw)&&n.afterDraw.call(this,e,o)},d.error=function(e){var o=this.options;if(!a(o.error))throw new Error(e);o.error.call(this,e)},d.success=function(e){var o,n,t=this.options,s=this.file,h=this.image,b=this.getExpectedEdge(),r=h.naturalHeight,m=h.naturalWidth;if(e&&e.size)if(!t.loose&&e.size>s.size&&!(b.width>m||b.height>r))console.warn("当前设置的是非宽松模式，压缩结果大于源图片，输出源图片"),e=s;else{var g=new Date;e.lastModified=g.getTime(),e.lastModifiedDate=g,e.name=s.name,e.name&&e.type!==s.type&&(e.name=e.name.replace(O,(o=e.type,(n=_(o)?o.substr(6):"")==="jpeg"&&(n="jpg"),"."+n)))}else console.warn("图片压缩出了点意外，输出源图片"),e=s;a(t.success)&&t.success.call(this,e)},f.file2DataUrl=function(e,o,n){var t=new FileReader;t.onload=function(){o(t.result)},t.onerror=function(){a(n)&&n("读取文件失败！")},t.readAsDataURL(e)},f.file2ArrayBuffer=function(e,o,n){var t=new FileReader;t.onload=function(s){o(s.target.result)},t.onerror=function(){a(n)&&n("读取文件失败！")},t.readAsArrayBuffer(e)},f.getStringFromCharCode=function(e,o,n){var t,s="";for(n+=o,t=o;t<n;t+=1)s+=String.fromCharCode(e.getUint8(t));return s},f.file2Image=function(e,o,n){var t=new Image,s=l.URL||l.webkitURL;if(l.navigator&&/(?:iPad|iPhone|iPod).*?AppleWebKit/i.test(l.navigator.userAgent)&&(t.crossOrigin="anonymous"),t.alt=e.name,t.onerror=function(){a(n)&&n("图片加载错误！")},s){var h=s.createObjectURL(e);t.onload=function(){o(t),s.revokeObjectURL(h)},t.src=h}else this.file2DataUrl(e,function(b){t.onload=function(){o(t)},t.src=b},n)},f.url2Image=function(e,o,n){var t=new Image;t.src=e,t.onload=function(){o(t)},t.onerror=function(){a(n)&&n("图片加载错误！")}},f.image2Canvas=function(e,o,n,t,s,h,b){var r=document.createElement("canvas"),m=r.getContext("2d");return r.width=h||e.naturalWidth,r.height=b||e.naturalHeight,a(t)&&t(m,r),m.save(),m.drawImage(e,0,0,o,n),m.restore(),a(s)&&s(m,r),r},f.canvas2DataUrl=function(e,o,n){return e.toDataURL(n||"image/jpeg",o)},f.dataUrl2Image=function(e,o,n){var t=new Image;t.onload=function(){o(t)},t.error=function(){a(n)&&n("图片加载错误！")},t.src=e},f.dataUrl2Blob=function(e,o){for(var n=e.split(",")[1],t=e.match(/^data:(.*?)(;base64)?,/)[1],s=atob(n),h=n.length,b=new Uint8Array(h),r=0;r<h;r++)b[r]=s.charCodeAt(r);return new Blob([b],{type:o||t})},f.blob2DataUrl=function(e,o,n){this.file2DataUrl(e,o,n)},f.blob2Image=function(e,o,n){this.file2Image(e,o,n)},f.canvas2Blob=function(e,o,n,t){var s=this;HTMLCanvasElement.prototype.toBlob||Object.defineProperty(HTMLCanvasElement.prototype,"toBlob",{value:function(h,b,r){var m=this.toDataURL(b,r);h(s.dataUrl2Blob(m))}}),e.toBlob(function(h){o(h)},t||"image/jpeg",n||.8)},f.upload=function(e,o,n){var t=new XMLHttpRequest,s=new FormData;s.append("file",o),t.onreadystatechange=function(){if(t.readyState!==4||t.status!==200)throw new Error(t);n&&n(t.responseText)},t.open("POST",e,!0),t.send(s)},f)f.hasOwnProperty(S)&&(p[S]=f[S])}]).default})})(P);var N=P.exports;V.exports=N;var Y=V.exports;const J=W(Y);var q={exports:{}};(function(v,x){(function(y,w){w()})(D,function(){function y(c,a){return typeof a>"u"?a={autoBom:!1}:typeof a!="object"&&(console.warn("Deprecated: Expected third argument to be a object"),a={autoBom:!a}),a.autoBom&&/^\s*(?:text\/\S*|application\/xml|\S*\/\S*\+xml)\s*;.*charset\s*=\s*utf-8/i.test(c.type)?new Blob(["\uFEFF",c],{type:c.type}):c}function w(c,a,_){var p=new XMLHttpRequest;p.open("GET",c),p.responseType="blob",p.onload=function(){f(p.response,a,_)},p.onerror=function(){console.error("could not download file")},p.send()}function i(c){var a=new XMLHttpRequest;a.open("HEAD",c,!1);try{a.send()}catch{}return 200<=a.status&&299>=a.status}function l(c){try{c.dispatchEvent(new MouseEvent("click"))}catch{var a=document.createEvent("MouseEvents");a.initMouseEvent("click",!0,!0,window,0,0,0,80,20,!1,!1,!1,!1,0,null),c.dispatchEvent(a)}}var u=typeof window=="object"&&window.window===window?window:typeof self=="object"&&self.self===self?self:typeof D=="object"&&D.global===D?D:void 0,O=u.navigator&&/Macintosh/.test(navigator.userAgent)&&/AppleWebKit/.test(navigator.userAgent)&&!/Safari/.test(navigator.userAgent),f=u.saveAs||(typeof window!="object"||window!==u?function(){}:"download"in HTMLAnchorElement.prototype&&!O?function(c,a,_){var p=u.URL||u.webkitURL,d=document.createElement("a");a=a||c.name||"download",d.download=a,d.rel="noopener",typeof c=="string"?(d.href=c,d.origin===location.origin?l(d):i(d.href)?w(c,a,_):l(d,d.target="_blank")):(d.href=p.createObjectURL(c),setTimeout(function(){p.revokeObjectURL(d.href)},4e4),setTimeout(function(){l(d)},0))}:"msSaveOrOpenBlob"in navigator?function(c,a,_){if(a=a||c.name||"download",typeof c!="string")navigator.msSaveOrOpenBlob(y(c,_),a);else if(i(c))w(c,a,_);else{var p=document.createElement("a");p.href=c,p.target="_blank",setTimeout(function(){l(p)})}}:function(c,a,_,p){if(p=p||open("","_blank"),p&&(p.document.title=p.document.body.innerText="downloading..."),typeof c=="string")return w(c,a,_);var d=c.type==="application/octet-stream",S=/constructor/i.test(u.HTMLElement)||u.safari,e=/CriOS\/[\d]+/.test(navigator.userAgent);if((e||d&&S||O)&&typeof FileReader<"u"){var o=new FileReader;o.onloadend=function(){var s=o.result;s=e?s:s.replace(/^data:[^;]*;/,"data:attachment/file;"),p?p.location.href=s:location=s,p=null},o.readAsDataURL(c)}else{var n=u.URL||u.webkitURL,t=n.createObjectURL(c);p?p.location=t:location.href=t,p=null,setTimeout(function(){n.revokeObjectURL(t)},4e4)}});u.saveAs=f.saveAs=f,v.exports=f})})(q);var Q=q.exports;const Z={name:"imageCompressor",data(){return{imageUrl:"",currentOriginalFile:null,lockRatio:!0,original:{size:0,width:0,height:0},desire:{quality:.5,width:500,height:500}}},methods:{loadJsonFromFile(v,x){console.log(v);const y=this;y.currentOriginalFile=v;const w=v;if(w==null)return!1;this.original.size=(w.size/1024).toFixed(2);const i=new Image;i.src=URL.createObjectURL(w.raw),i.onload=()=>{y.original.width=i.width,y.original.height=i.height,y.desire.width=i.width,y.desire.height=i.height},y.imageUrl=URL.createObjectURL(w.raw),this.$refs.upload.clearFiles()},calcImgSize(){if(!this.lockRatio)return;const v=this;v.desire.height=Math.round(v.desire.width/v.original.width*v.original.height)},startCompressor(){this.compressionImage(this.currentOriginalFile.raw).then(v=>{Q.saveAs(v,this.currentOriginalFile.name)})},compressionImage(v){const x=this;return new Promise((y,w)=>{new J({file:v,mimeType:"image/jpeg",quality:x.desire.quality,width:x.desire.width,height:x.desire.height,redressOrientation:!1,beforeCompress:function(i){console.log("压缩之前图片尺寸大小: ",i.size),console.log("mime 类型: ",i.type)},success:function(i){console.log("压缩之后图片尺寸大小: ",i.size),console.log("mime 类型: ",i.type),console.log("实际压缩率： ",((v.size-i.size)/v.size*100).toFixed(2)+"%"),y(i)},error(i){w(i)}})})}}},H=v=>(G("data-v-8b7ec0c6"),v=v(),K(),v),$={class:"imageCompressor"},ee=["src"],te={key:1,viewBox:"0 0 1024 1024",class:"avatar-uploader-icon",xmlns:"http://www.w3.org/2000/svg"},ne=H(()=>C("path",{fill:"currentColor",d:"M480 480V128a32 32 0 0 1 64 0v352h352a32 32 0 1 1 0 64H544v352a32 32 0 1 1-64 0V544H128a32 32 0 0 1 0-64h352z"},null,-1)),oe=[ne],ie=H(()=>C("div",{style:{height:"15px"}},null,-1)),re={style:{display:"flex"}},ae=H(()=>C("div",{style:{height:"25px"}},null,-1)),se={style:{"text-align":"right"}};function le(v,x,y,w,i,l){const u=I("el-upload"),O=I("el-row"),f=I("el-col"),c=I("el-switch"),a=I("el-input-number"),_=I("el-input"),p=I("el-button");return A(),T("div",$,[M(O,null,{default:k(()=>[M(u,{ref:"upload",class:"avatar-uploader",action:"https://shiva.show","show-file-list":!1,drag:!0,"auto-upload":!1,"on-change":l.loadJsonFromFile,limit:1},{default:k(()=>[i.imageUrl?(A(),T("img",{key:0,src:i.imageUrl,class:"avatar"},null,8,ee)):(A(),T("svg",te,oe))]),_:1},8,["on-change"])]),_:1}),ie,M(O,{gutter:20},{default:k(()=>[M(f,{span:8},{default:k(()=>[C("div",null,"原素材："+z(i.original.size)+" KB",1),C("div",null,"宽度： "+z(i.original.width)+" px",1),C("div",null,"高度： "+z(i.original.height)+" px",1)]),_:1}),M(f,{span:16},{default:k(()=>[C("div",null,[L(" 锁定比例： "),M(c,{modelValue:i.lockRatio,"onUpdate:modelValue":x[0]||(x[0]=d=>i.lockRatio=d),"active-color":"#13ce66","inactive-color":"#ff4949"},null,8,["modelValue"])]),C("div",re,[C("div",null,[L("质量： "),M(a,{modelValue:i.desire.quality,"onUpdate:modelValue":x[1]||(x[1]=d=>i.desire.quality=d),size:"small",min:.01,step:.01,max:1},null,8,["modelValue"])]),C("div",null,[L("宽度： "),M(_,{placeholder:"",modelValue:i.desire.width,"onUpdate:modelValue":x[2]||(x[2]=d=>i.desire.width=d),onBlur:l.calcImgSize,size:"small"},{append:k(()=>[L("px")]),_:1},8,["modelValue","onBlur"])]),C("div",null,[L("高度： "),M(_,{placeholder:"",modelValue:i.desire.height,"onUpdate:modelValue":x[3]||(x[3]=d=>i.desire.height=d),disabled:this.lockRatio,size:"small"},{append:k(()=>[L("px")]),_:1},8,["modelValue","disabled"])])])]),_:1})]),_:1}),ae,C("div",se,[M(p,{type:"success",onClick:l.startCompressor},{default:k(()=>[L("压缩并下载")]),_:1},8,["onClick"])])])}const ue=X(Z,[["render",le],["__scopeId","data-v-8b7ec0c6"],["__file","imageCompressor.vue"]]);export{ue as default};
